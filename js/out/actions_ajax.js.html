<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>VerbaAlpina Crowdsourcing Tool - Documentation Source: actions_ajax.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">VerbaAlpina Crowdsourcing Tool - Documentation</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-Ajax_Calls.html">Ajax_Calls</a></li><li><a href="module-Content_Interactions.html">Content_Interactions</a></li><li><a href="module-Geo_Parser.html">Geo_Parser</a></li><li><a href="module-Map-Objects_Generator.html">Map-Objects_Generator</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: actions_ajax.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 * Difines and performes Ajax Calls to the server for - loading data from the database, building global javascript arrays with that data and saving user's input.
 * @module Ajax_Calls
 * 
 * 
 */

/**
 * Array of all municipalities
 * @var
 * @type {Array}
 *  */
var locations;

/**
 * Array of all concepts in the user's language.
 * @var
 * @type {Array}
 *  */
var concepts;

/**
 * Array of all links to the images.
 * @var
 * @type {Array}
 *  */
var images;

/**
 * Array of all answers submitted by the user.
 * @var
 * @type {Array}
 *  */
var submitedAnswers = [];

/**
 * Indexed Array of all answers submitted by the user.
 * @var
 * @type {Array}
 *  */
var submitedAnswers_indexed = [];

/**
 * Array containing all location ids, where the user has entered an answer.
 * @var
 * @type {Array}
 */
var existingLocations = new Array();

/**
 * Improves UI, used for state check, when the user submits an answer.
 * @type {Boolean}
 */
var submit_button_clicked = false;

/**
 * Array of all submitted answers by the user.
 * @type {Array}
 */
var aeusserungen;

/**
 * not used
 * @deprecated
 */
var id_auesserung_current_input;

/**
 * Number of importain concepts - used to mark the concepts in the concepts data table.
 * @type {Integer}
 */
var important_concepts_count;

/**
 * not used
 * @deprecated 
 * @type {Array}
 */
var indexed_locations_aeusserungen_array = [];

/**
 * Checks if user has already choosen a language from the modal menue. Defaults to false if user is not logged in.
 * @type {Boolean}
 */
var language_is_set;

/**
 * Variable to check if the user has logged in.
 * @type {Boolean}
 */
var	userLoggedIn;

/**
 * Variable to check if the user is anonymous.
 * @type {Boolean}
 */
var anonymousCrowder;

/**
 * Name of the user. May be name of the logged in user or the anonymous_{unique number}.
 * @type {String}
 */
var current_user;

/**
 * Language Number choosen by logged in users.
 * @type {String}
 */
var	crowder_lang; 

/**
 * Email Adress of the logged in user.
 */
var	user_email;
/*var is_admin;*/


var user_input_not_full = ['Bitte füllen Sie alle Eingabefelder aus!', 'Rempliez tous les champs de saisie, s´il vous plaît!','Compilate tutti i campi di inserimento, per favore!','Prosimo, izpolnite vsa vnosna polja!'];
var field_not_full = ['Bitte füllen Sie das Eingabefeld aus!', 'Rempliez le champ de saisie, s´il vous plaît!','Compilate il campo di inserimento, per favore!','Prosimo, izpolnite vnosno polje!'];
var change_question = ['Ändern in: ','Modifier: ','Modificare: ','Spremeni v: ']; //change_question[current_language]

	/**
	 * Initializes Ajax calls when document is loaded.
	 * @function starts the initial ajax calls when the site has loaded.
	 * @async
	 */
	jQuery(document).on('ready', function(){

		jQuery('#custom_backdrop').show();


							
							/**
							 * Initiating the async calls to server.
							 * @async
							 * @function gets information about the user from the server
							 * @return {Array} user_data     
							 */
							jQuery.ajax({
								url: ajax_object.ajax_url,
								type: 'POST',
								data: {
									action : 'request_user_data',
								},
								success : function( response ) {

								declare_user_data(JSON.parse(response));

								/**
								 * Get number of importain concepts.
								 * @async
								 * @function gets information about the importaint concepts
								 * @return {Array} important_concepts_count     
								 */
								jQuery.ajax({
									url: ajax_object.ajax_url,
									type: 'POST',
									data: {
										action : 'getConceptCount',
									},
									success : function( response ) {
										important_concepts_count = JSON.parse(response);

														/**
														 * Get all images links from server.
														 * @async
														 * @function gets image links
														 * @return {Array} images     
														 */
														jQuery.ajax({
														url: ajax_object.ajax_url,
														type: 'POST',
														data: {
															action : 'getImage',
														},
														success : function( response ) {
															images = JSON.parse(response);

																
																 /**
																 * Get and display AlpenKonventione Polygon
																 * @namespace Ajaxs Calls
																 * @async
																 * @function gets alpine convention borders
																 * @return {Array} border coordinates     
																 */
																 jQuery.ajax({
																		url: ajax_object.ajax_url,
																		type: 'POST',
																		data: {
																			action : 'getBordersGeoData',
																			geoData : 'alpenKonvention'
																		},
																		success : function( response ) {

																			addGeometryAlps(response);
	 																		initTool();
																			
																		}	
																	}); //konvention

														}
													});
											
										}
									});
								}
							});
			

	}); //document ready

/** 
 * Gets values from all answer-input fields and performs an ajax call with the user's answer to be saved in the database. Performs all checks if all fields are filled correctly. And places a marker when the input is saved in the database.
 * @function saveWord
 */
function saveWord(){
		

				
				var input_word = jQuery("#user_input").val();
				var location = jQuery('#location_span').html();
				var location_id = jQuery('#location_span').attr('data-id_location');
				var concept = jQuery('#word_span').html();
				var concept_id = jQuery('#word_span').attr('data-id_concept');
				var concept_index = concepts_index_by_id[concept_id].index;


				/*Check if fields for Konzept and Region are filled*/
				if(input_word.localeCompare("") != 0  &amp;&amp; location_id != null &amp;&amp; concept_selected == true){

			    stage = 5;
		        jQuery('#submitanswer').popover('hide');	

				var answer = {concept: concept, user_input : input_word , location: location, location_id:location_id };
			
					if(!isDuplicate_indexed(answer)){

						/**
						 * Gets user's ID. Used to generate a unique crowder_id cookie, when the user submits an answer.
						 * @async
						 * @function getUserID
						 */
						jQuery.ajax({
							url : ajax_object.ajax_url  ,
							type : 'POST',
							data : {
								action : 'getUserID',							
							},
							success : function( response ) {
							
							if(current_user==null)current_user = JSON.parse(response);

							createCookie("crowder_id",current_user);		
						/**
						 * Send all data(location, location id, concept, concept id, user answer and current user id(not logged in users) or user name(logged in users)) to server.
						 * @function save_word_async
						 * @async
						 */
						jQuery.ajax({
							url : ajax_object.ajax_url  ,
							type : 'POST',
							data : {
								action : 'saveWord',
								gemeinde : location,
								gemeinde_id : location_id,
								konzept : concept,
								konzept_Id : concept_id,
				       	        bezeichnung : input_word,
				       	        current_user : current_user

							},
							beforeSend: function(){
								
							},
							success : function( response ) {

								

								var id_aeusserung = JSON.parse(response);

								if(id_aeusserung == null) return;
								
								jQuery('#image_modal').modal('hide'); 

										/**
										* Load the location's polygon to be displayed on the map, when user's answer is successfully saved to the database.
										* @function load_location_polygon
										* @async
										*/
								        jQuery.ajax({
									          url: ajax_object.ajax_url,
									          type: 'POST',
									          data: {
									            action : 'getChoosenGemeinde',
									            location_id : location_id,
									            searchedGemeinde : location,
									            concept : concept,
									            concept_id : concept_id,
									            bezeichnung : input_word
									          },
									          success : function( response ) {

									          	session_answer_count ++;
									          	if(!userLoggedIn)checkLoginPopUp();
									          	
									          	var answer = {concept: concept, user_input : input_word , location: location, id_auesserung: id_aeusserung,concept_id:concept_id,concept_index:concept_index};

									          	submitedAnswers.push(answer);
									          	submitedAnswers_indexed[id_aeusserung]= answer;
												delete unanswered_concepts[concept_index];

									          	var entry = {};
									          	entry[id_aeusserung] = {author: current_user , id_aeusserung:id_aeusserung.toString(), id_concept:concept_id, id_geo:location_id, konzept:concept, ortsname:location, word:input_word, tokenisiert:"0"};
												
												if(aeusserungen_by_locationindex[location_id]==null){
													aeusserungen_by_locationindex[location_id] = entry;
												}

												else{
								          			aeusserungen_by_locationindex[location_id][id_aeusserung] = {author: current_user , id_aeusserung:id_aeusserung.toString(), id_concept:concept_id, id_geo:location_id, konzept:concept, ortsname:location, word:input_word, tokenisiert:"0"};
												}		

									  
									  			add_user_marker(JSON.parse(response),id_aeusserung);
									  			change_feature_style(old_feature,check_user_aesserungen_in_location(location));

									  			setTimeout(function() {

										  			if(location_markers[location_id]){
										  				change_marker(location_markers[location_id],1,"green");
													}else{
														var obj = JSON.parse(response);

														var element = {count:"1", geo_data:{geo:obj.centerCoordinates,location_id:obj.location_id,userCheck:true}};
														display_location_markers(element);
													}

											     }, 300);



									            jQuery('#word_span').data("id_concept",null);

										            jQuery('.row_1').fadeOut().fadeIn();
										            jQuery('.row_2').fadeOut(function(){
										            		   jQuery('#submitanswer').popover('hide');

										            		   jQuery('#user_input').val("");
										           			   jQuery('#word_span').text(the_word_concept[current_language]);
						           			   	               setTimeout(function() {

						           			   	               			jQuery('#word_span').popover('show');

				           			   	     	          			     	jQuery('.pop_word_span').parent().on('click',function(){
						                        								 handleWordSpanClick();					             
						               									     }).addClass('c_hover'); 
						           			   	           				}, 1000);
						           			   	               		    process_restarted = true;

										            }).fadeIn();
									
										            concept_selected = false;
										       	    word_entered = false;
									            	stage = 3;
									           
									            	deSelectTableEntry(concept_index);

		            			  				        var entry = num_of_answers_by_id[parseInt(concept_id)];
        	     			             			    if(entry==null) num_of_answers_by_id[parseInt(concept_id)] = 1;
    													else num_of_answers_by_id[parseInt(concept_id)] +=1;

        	     			             			checkTableEntry(concept_id);

 			             	
        	     			             			var row = jQuery(datatable_concepts.row(concept_index).node());
        	     			             			if(row.find('.num_of_answers').length==0){
        	     			             				row.find('.dataparent').append(jQuery('&lt;div class="num_of_answers">1&lt;/div>'));
        	     			             			}

        	     			             			else{
        	     			             				row.find('.num_of_answers').text(num_of_answers_by_id[parseInt(concept_id)]);
        	     			             			}

        	     			           
									      			current_concept_index = -1;

									      			var ua = navigator.userAgent.toLowerCase();
													var isAndroid = ua.indexOf("android") > -1; 
													if(isAndroid) {
														map.panTo(location_markers[location_id].getPosition());
													}
									      			
									          }
								          });

							}
						});

						}});
					}else{

						for (var key in submitedAnswers_indexed) {
						  if (submitedAnswers_indexed.hasOwnProperty(key)) {
						  	 if(input_word.localeCompare(submitedAnswers_indexed[key].user_input) == 0 &amp;&amp;  concept.localeCompare(submitedAnswers_indexed[key].concept) == 0){
								var id_auesserung = submitedAnswers_indexed[key].id_auesserung;
								var concept_id = submitedAnswers_indexed[key].concept_id;
								//console.log("AEUSSERUNG ID: " + id_auesserung);						
								break;
							}
						  }
						}


					 editInputA(id_auesserung,concept_id,location_id,concept,false);


	
					
				}
				}else{
					jQuery('.message_modal_content').text(user_input_not_full[current_language]);
					jQuery('#message_modal').modal({
	                   backdrop: 'static',
	                   keyboard: false
	                });
				}



	}


/**
 * Loops through all submitted answers and performs fill_answers() on each of them.
 * @param  {Array} array_submitted_answers An array containg submited answers by the user.
 * 
 */
function fill_submitted_answers(array_submitted_answers){
	for(var i = 0; i &lt; array_submitted_answers.length; i++) {
	    var obj = array_submitted_answers[i];
	  fill_answers(obj);
	}
}

/**
 * Adds an object, containing - Concept(and id), submited answer(and id), location and author of the submitted answer, to submitedAnswers(global array).
 * @param  {Object} obj Contains a single concept-submitted entry, that the user has previously created.
 * 
 */
function fill_answers(obj){
	var concept_id = obj.id_concept;
	var concept = obj.konzept;
	var word_inputed = obj.word;
	var location_name = obj.ortsname;
	var id_auesserung = obj.id_aeusserung;
	var author = obj.author;
	if(author.localeCompare(current_user) == 0 &amp;&amp; author.localeCompare("anonymousCrowder_90322") != 0){

		var concept_idx = concepts_index_by_id[parseInt(concept_id)].index;

	    var answer = {concept: concept, user_input : word_inputed , location: location_name , id_auesserung: id_auesserung ,concept_id:concept_id,concept_index:concept_idx};
	  submitedAnswers.push(answer);
    }
}

/**
 * Creates a indexed array.
 * @param arrayA 	{Array}    Input Array
 * @param  can_edit {Boolean}  Checks if the user can edit this entry.
 * @return 			{Array}          indexed Array
 */
function create_submited_answers_index_array(arrayA,can_edit){
	var result = {};
	var is_admin = can_edit;


	for(var i = 0; i &lt; arrayA.length; i++) {
			var obj = arrayA[i];

			var concept_id = obj.id_concept;
			var concept = obj.konzept;
			var word_inputed = obj.word;
			var location_name = obj.ortsname;
			var id_auesserung = obj.id_aeusserung;
			var author = obj.author;
			
			if((author.localeCompare(current_user) == 0 &amp;&amp; author.localeCompare("anonymousCrowder_90322") != 0) || is_admin){

				var concept_idx = concepts_index_by_id[parseInt(concept_id)].index;
				
			    var answer = {concept: concept, user_input : word_inputed , location: location_name , id_auesserung: id_auesserung ,concept_id:concept_id,concept_index:concept_idx};
		 		result[parseInt(id_auesserung)] = answer;
	   		}
		
	}

	return result;
}

/**
 * Display markers for each location and the corresponding number of answers in each one.
 * @param  {Array} arrayA   Indexed array(index: location id) of each location(name, center point).
 * @param  {Boolean} can_edit Checks if the user can edit the answers(Only for admins).
 *
 */
function get_aeussetungen_locations_curLang(arrayA,can_edit){
	for (var key in arrayA) {
	  if (arrayA.hasOwnProperty(key)) {
	  	if(arrayA[key].count!=null)display_location_markers(arrayA[key],can_edit);
	  }
	}

	jQuery('#custom_backdrop').fadeOut('slow',function(){
                        //if(language_is_set)jQuery('#welcomeback_modal').modal('hide');
    });
}


/**
 * Build an indexed array(index location id), containing all answers(type: aeusserung, id_aeusserung, author, ortsname(location), word) submitted by the users.
 * @param  {Array} aeusserungen Array with all answers by users.
 * @return {Array}              Indexed array(location id: [answers])
 */
function build_indexed_aeusserungen_array(aeusserungen){
	var result = {};

  for(var i=0;i&lt;aeusserungen.length;i++){

  	    var entry = {};
      	entry[aeusserungen[i].id_aeusserung] = aeusserungen[i];

      if(result[parseInt(aeusserungen[i].id_geo)]==null){

      result[parseInt(aeusserungen[i].id_geo)] = entry;
      }
      else{
      	result[parseInt(aeusserungen[i].id_geo)][aeusserungen[i].id_aeusserung] = aeusserungen[i];
      }
  }

return result;

}

/**
 * created html element, which will be used in editInput()
 * @see editInput() in content_interaction.js
 * @return {String} HTML
 */
function returnChangeInput(){
	var output = [
		"&lt;div id='inputWrapper'>",
		/*"Sie haben gesagt:  In " + ort + " sagt man zu " + concept + " " +  auesserung ,*/
		/* "" + translateInfoWindowText(ort, concept,auesserung, current_user) + "", */
		"" + "&lt;div style='display:inline-block;margin-right:10px;margin-bottom:5px;'>" + change_question[current_language] + "&lt;/div>",
		"&lt;div style='display:inline-block;width:100%'>&lt;input style='width:100%; margin-right:10px;display:inline-block;' id='userAuesserungInput' type='text'/>&lt;/div>",
		"&lt;div style='display:block;margin-top:10px;'>&lt;button style='display:inline-block;margin-right:10px;padding:5px;' class='btn btn-primary' id='updateAuesserung' type='button'>" + change_input[current_language] + "&lt;/button>",
		"&lt;/div>", /*"&lt;button style='display:inline-block;padding:5px;' class='btn btn-primary ' data-concept_id=\"" + id_concept + "\" data-todelete=\"" + id_auesserung + "\"  data-ort= \"" + ort + "\" type='button' id='deleteAuesserung' type='button' onclick='deleteInput()'>" + delete_input[current_language] + "&lt;/button>*/

		"&lt;/div>"
	].join("");


	 // onclick='updateInput()'

	return output;
}


/**
 * Updated user's answer(Used by editInputA()).
 * @see editInputA() in generateMap.js
 * @param  {String} concept       Concept name
 * @param  {Integer} id_auesserung Id of the submited answer
 * @param  {Integer} concept_id    Concept Id
 * @param  {Integer} id_location   Location Id
 * @param  {Integer} row_to_update The row number from the data table that will be updated
 * 
 */
function updateInput(concept, id_auesserung,concept_id,id_location,row_to_update){

	console.log("Send");
	var new_auesserung = jQuery('#userAuesserungInput').val();

	var stop = false;

	for (var key in submitedAnswers_indexed) {
	    var oldanswer = submitedAnswers_indexed[key].user_input;
		if(oldanswer==new_auesserung)stop=true;

	}


	if(new_auesserung.localeCompare("") != 0 &amp;&amp; !stop){	

	if(row_to_update){		
		row_to_update.find('td:nth-child(2)').first().text("\""+new_auesserung+"\"");	
	}

    updateAnswers_indexed(id_auesserung,new_auesserung,id_location);	

	jQuery.ajax({
							url: ajax_object.ajax_url,
							type: 'POST',
							data: {
								action : 'updateAuesserung',
								id_auesserung : id_auesserung,
								new_auesserung : new_auesserung
							},
							success : function( response ) {
								//console.log(response);
								// updateSuccess(id_auesserung,new_auesserung,concept);
								// var answer = {concept: concept, user_input : new_auesserung , location: ort, id_auesserung: id_auesserung};

							}
					}); 

     jQuery('#input_modal').modal('hide');

	}else{
		markInputRed(jQuery('#userAuesserungInput'));
	}
}

/**
 * Sends an Ajax call to delete answer from the server.
 * @param  {Integer} id_auesserung Submited answer Id
 * @param  {String} ort           Location name
 * @param  {Integer} concept_id    Concept Id
 * @param  {Integer} location_id   Location Id
 * 
 */
function deleteInput(id_auesserung, ort, concept_id, location_id){

	deleteFromAnswers_indexed(id_auesserung, location_id);
	change_marker(location_markers[location_id],-1,"green");


	num_of_answers_by_id[concept_id]--;
	if(num_of_answers_by_id[concept_id]==0){
		deleteFromConceptTable(concept_id);
	}
	else{
		checkTableEntry(concept_id);
	}

	jQuery.ajax({
		url: ajax_object.ajax_url,
		type: 'POST',
		data: {
			action : 'deleteAuesserung',
			id_auesserung : id_auesserung,
			ort : ort,
			gemeinde_id : location_id,
			current_user : current_user
		},
		success : function( response ) {
			/*If informant was deleted from db and has no other submited answers, delete cookie and current_user*/
			var user_deleted = JSON.parse(response);
			if(user_deleted &amp;&amp; isEmpty(submitedAnswers_indexed) &amp;&amp; !userLoggedIn){
				eraseCookie("crowder_id");
				current_user = null;
			}
		}
	}); 

	if(old_feature != null &amp;&amp; ort.localeCompare(old_feature.getProperty('location')) == 0 ) {
		change_feature_style(old_feature,check_user_aesserungen_in_location(ort));
	}
}




/**
 * Delete user's answer from submitedAnswers_indexed and aeusserungen_by_locationindex.
 * @param  {Int} id_auesserung Submited answer Id
 * @param  {Int} id_location   Location Id
 * 
 */
function deleteFromAnswers_indexed(id_auesserung,id_location){
	
	delete submitedAnswers_indexed[id_auesserung];

	delete aeusserungen_by_locationindex[id_location][id_auesserung];
}



/**
 * Update user's answer in submitedAnswers_indexed and aeusserungen_by_locationindex.
 * @param  {Int} id_auesserung Submited answer Id
 * @param  {String} input         User's Input
 * @param  {Int} id_location   Location Id
 * 
 */
function updateAnswers_indexed(id_auesserung,input,id_location){

	submitedAnswers_indexed[id_auesserung].user_input = input;	
	aeusserungen_by_locationindex[id_location][id_auesserung].word = input;
}


// function updateSuccess(id_auesserung,new_auesserung,concept,marker){

// 		for(var i = 0; i &lt; markers.length; i++){
// 			if(marker === markers[i].marker){

		
// 				var auesserung_id = marker.id_auesserung;
// 				var ort = marker.location;
// 				var concept = marker.concept;
// 				var point = marker.getPosition();
// 				var concept_id =  marker.concept_id;

// 			}
// 		}
				
// 		jQuery('#input_modal').modal('hide');

// }


/**
 * [deleteFromConceptTable description]
 * @param  {Int} _concept_id [description]
 * 
 */
function deleteFromConceptTable(_concept_id){

var table_index_t = concepts_index_by_id[parseInt(_concept_id)].index;
var name  = concepts_index_by_id[parseInt(_concept_id)].name;
var row = datatable_concepts.row(table_index_t).node();

jQuery(row).removeClass('green_row');
jQuery(row).find('.num_of_answers').remove();
jQuery(row).find('.dataspan').find('.fa-check').remove();

		if(table_index_t&lt;important_concepts_count){

			var icon = jQuery('&lt;i class="fa fa-exclamation-triangle" aria-hidden="true">&lt;/i>');
			jQuery(row).find('.dataspan').prepend(icon);
		}
unanswered_concepts[table_index_t] = concepts_cur_lang[table_index_t]; //add concept back to unanswered list;
		
}


/**
 * [checkTableEntry description]
 * @param  {Int} _concept_id [description]
 * 
 */
function checkTableEntry(_concept_id){

var table_index_t = concepts_index_by_id[parseInt(_concept_id)].index;
var row = datatable_concepts.row(table_index_t).node();
jQuery(row).addClass('green_row');

var icon = jQuery('&lt;i class="fa fa-check" aria-hidden="true">&lt;/i>');

	if(jQuery(row).find('.fa-check').length==0){
        jQuery(row).find('.dataspan').prepend(icon);
	}


jQuery(row).find('.fa-exclamation-triangle').remove();


	if(jQuery(row).find('.num_of_answers').length==0){
		jQuery(row).find('.dataparent').append(jQuery('&lt;div class="num_of_answers">1&lt;/div>'));
	}

	else{
		jQuery(row).find('.num_of_answers').text(num_of_answers_by_id[parseInt(_concept_id)]);
	}
		
}

/**
 * [selectTableEntry description]
 * @param  {Int} table_index index of the selected entry in the data table
 * 
 */
function selectTableEntry(table_index){

var row = datatable_concepts.row(table_index).node();
// console.log(datatable_concepts.row(table_index));

jQuery(row).addClass('concept-list-select-tr');
jQuery(row).find('.dataparent').addClass('list_selected_concept');

	if(table_index>=important_concepts_count){
      	var icon =  jQuery('&lt;i class="fa fa-arrow-right list-select-arrow" aria-hidden="true">&lt;/i>');
      				if(jQuery(row).find('.fa-arrow-right').length==0){
                    jQuery(row).find('.dataspan').prepend(icon);
                }
	}

}

/**
 * [deSelectTableEntry description]
 * @param  {Int} table_index [description]
 * 
 */
function deSelectTableEntry(table_index){

	var row = datatable_concepts.row(table_index).node();

	jQuery(row).removeClass('concept-list-select-tr');
	jQuery(row).find('.list_selected_concept').removeClass('list_selected_concept');

	if(table_index>=important_concepts_count){
	  jQuery(row).find('.list-select-arrow').remove();
	}

}





function checkEnteredConcepts(){
	for(var i=0;i&lt;submitedAnswers.length;i++){
		   checkTableEntry(submitedAnswers[i].concept_id);
	}

}

/**
 * [checkEnteredConcepts_indexed description]
 * 
 */
function checkEnteredConcepts_indexed(){
	for (var key in submitedAnswers_indexed) {
	  if (submitedAnswers_indexed.hasOwnProperty(key)) {
	  	 checkTableEntry(submitedAnswers_indexed[key].concept_id);
	  }
	}
}


/**
 * Marks the input field red if user tries to submit the same answer or an empty field, when changing his answer.
 * @param  {String} input [description]
 * 
 */
function markInputRed(input){
	/*input field turns red for 1 sec*/
	input.css('border-color', 'red'); //.addClass( "myClass yourClass" );
	input.css('background-color', 'rgb(224, 143, 143)');
	setTimeout(function(){
		input.css('border-color', 'white');
		input.css('background-color', 'white');
}, 1000);
	/*   jQuery('#editInput_modal').modal({
                   keyboard: true
      });
		jQuery('.editInput_modal_content').html("&lt;div>" + field_not_full[current_language] + "&lt;/div>");*/

}






function showElement(n){
	var images = document.getElementsByClassName('images');
	images[n].style.display = 'block';
	//console.log(images);
}


function isDuplicate(answer){
	//var answer = {concept: concept, user_input : input_word , location: location};
	var exists = false;

	for(var i = 0; i&lt;submitedAnswers.length;i++){
		var cnt = submitedAnswers[i].concept;
		var input = submitedAnswers[i].user_input;
		var lct = submitedAnswers[i].location;

		if(input.localeCompare(answer.user_input) == 0  &amp;&amp; lct.localeCompare(answer.location) == 0 &amp;&amp; cnt.localeCompare(answer.concept) == 0){
			exists = true;
			break;
		}
	}

	return exists;

}

/**
 * Checks if the user's answer is a dublicate(he has already entered the same answer for the same concept in that location).
 * @param  {Array}  answer [description]
 * @return {Boolean}        [description]
 */
function isDuplicate_indexed(answer){
	//var answer = {concept: concept, user_input : input_word , location: location};
	var exists = false;

	for(var key in submitedAnswers_indexed){
		if (submitedAnswers_indexed.hasOwnProperty(key)) {
			var cnt = submitedAnswers_indexed[key].concept;
			var input = submitedAnswers_indexed[key].user_input;
			var lct = submitedAnswers_indexed[key].location;
			var lct_id = submitedAnswers_indexed[key].location_id;

			if(input.localeCompare(answer.user_input) == 0  &amp;&amp; lct.localeCompare(answer.location) == 0 &amp;&amp; cnt.localeCompare(answer.concept) == 0){
				exists = true;
				break;
			}
		}
	}

	return exists;

}


/**
 * check if string contains a substring
 * @param  {String} needle [description]
 * 
 */
var contains = function(needle) {
    // Per spec, the way to identify NaN is that it is not equal to itself
    var findNaN = needle !== needle;
    var indexOf;

    if(!findNaN &amp;&amp; typeof Array.prototype.indexOf === 'function') {
        indexOf = Array.prototype.indexOf;
    } else {
        indexOf = function(needle) {
            var i = -1, index = -1;

            for(i = 0; i &lt; this.length; i++) {
                var item = this[i];

                if((findNaN &amp;&amp; item !== item) || item === needle) {
                    index = i;
                    break;
                }
            }

            return index;
        };
    }

    return indexOf.call(this, needle) > -1;
};

/**
 * Creates a cookie with name, value and exp. date
 * @param  {String} name  [description]
 * @param  {String} value [description]
 * @param  {Int} days  [description]
 * 
 */
function createCookie(name,value,days) {
	if (days) {
		var date = new Date();
		date.setTime(date.getTime()+(days*24*60*60*1000));
		var expires = "; expires="+date.toGMTString();
	}
	else var expires = "";
	document.cookie = name+"="+value+expires+"; path=/";
}

/**
 * Read value of a cookie by name.
 * @param  {String} name [description]
 * @return {String}      [description]
 */
function readCookie(name) {
	var nameEQ = name + "=";
	var ca = document.cookie.split(';');
	for(var i=0;i &lt; ca.length;i++) {
		var c = ca[i];
		while (c.charAt(0)==' ') c = c.substring(1,c.length);
		if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
	}
	return null;
}

/**
 * Delete cookie.
 * @param  {String} name [description]
 * 
 */
function eraseCookie(name) {
	createCookie(name,"",-1);
}

/**
 * Check if an object is empty.
 * @param  {Object}  obj [description]
 * @return {Boolean}     [description]
 */
function isEmpty(obj) {
    for(var prop in obj) {
        if(obj.hasOwnProperty(prop))
            return false;
    }

    return true;
}

/**
 * Saves the choosen language of the user in the database.
 * @param  {String} user_name [description]
 * 
 */
function userRegisterDone(user_name){

	//console.log(data);

	jQuery.ajax({
			url: ajax_object.ajax_url,
			type: 'POST',
			data: {
				action : 'save_user_language',
				user_lang : current_language,
				anonymous_id : current_user,
				user_name : user_name
			},
			success : function( response ) {
				console.log("Language Added");
				console.log(JSON.parse(response));
			}
	}); 
}


/**
 * Saves user data in global variables.
 * @param  {Object} obj [description]
 * 
 */
function declare_user_data(obj){
	userLoggedIn = obj.userLoggedIn;

	if(userLoggedIn){
		language_is_set = obj.language_is_set ;
		anonymousCrowder = false ;
		current_user = obj.current_user ;
		crowder_lang =  obj.crowder_lang; 
		user_email = obj.user_email;
	}else{
		language_is_set = obj.language_is_set ;
		anonymousCrowder = true;
		current_user = obj.current_user;
		crowder_lang =  null;
	}
	//console.log(obj);
}

/**
 * Check if user(only for not logged in users) has submited answers and delete crowder_id cookie if he has no answers.
 * 
 */
function check_user_aeusserungen(){
	if(isEmpty(submitedAnswers_indexed) &amp;&amp; !userLoggedIn){
		eraseCookie("crowder_id");
		current_user = null;
	}
}

/**
 * Checks if the user has any answers in the current location. This is used for changing the color of the location marker: blue - user has not entered a answer in the location, green - user has entered an answer in that location.
 * @param  {String} location [description]
 * 
 */
function check_user_aesserungen_in_location(location){
	var has_aeusserungen = false;

	for (var key in submitedAnswers_indexed) {
					  if (submitedAnswers_indexed.hasOwnProperty(key)) {
					  	 if(location.localeCompare(submitedAnswers_indexed[key].location) == 0){
							has_aeusserungen = true;					
							break;
						}
 					 }
	}
	return has_aeusserungen;
}</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a>
	
		on 2017-09-26T17:15:41+02:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
