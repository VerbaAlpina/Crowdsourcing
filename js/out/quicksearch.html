<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"actions_ajax.js.html":{"id":"actions_ajax.js.html","title":"Source: actions_ajax.js","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Source: actions_ajax.js /** * Difines and performes Ajax Calls to the server for - loading data from the database, building global javascript arrays with that data and saving user's input. * @module Ajax_Calls * * */ /** * Array of all municipalities * @var * @type {Array} * */ var locations; /** * Array of all concepts in the user's language. * @var * @type {Array} * */ var concepts; /** * Array of all links to the images. * @var * @type {Array} * */ var images; /** * Array of all answers submitted by the user. * @var * @type {Array} * */ var submitedAnswers = []; /** * Indexed Array of all answers submitted by the user. * @var * @type {Array} * */ var submitedAnswers_indexed = []; /** * Array containing all location ids, where the user has entered an answer. * @var * @type {Array} */ var existingLocations = new Array(); /** * Improves UI, used for state check, when the user submits an answer. * @type {Boolean} */ var submit_button_clicked = false; /** * Array of all submitted answers by the user. * @type {Array} */ var aeusserungen; /** * not used * @deprecated */ var id_auesserung_current_input; /** * Number of importain concepts - used to mark the concepts in the concepts data table. * @type {Integer} */ var important_concepts_count; /** * not used * @deprecated * @type {Array} */ var indexed_locations_aeusserungen_array = []; /** * Checks if user has already choosen a language from the modal menue. Defaults to false if user is not logged in. * @type {Boolean} */ var language_is_set; /** * Variable to check if the user has logged in. * @type {Boolean} */ var userLoggedIn; /** * Variable to check if the user is anonymous. * @type {Boolean} */ var anonymousCrowder; /** * Name of the user. May be name of the logged in user or the anonymous_{unique number}. * @type {String} */ var current_user; /** * Language Number choosen by logged in users. * @type {String} */ var crowder_lang; /** * Email Adress of the logged in user. */ var user_email; /*var is_admin;*/ var user_input_not_full = ['Bitte füllen Sie alle Eingabefelder aus!', 'Rempliez tous les champs de saisie, s´il vous plaît!','Compilate tutti i campi di inserimento, per favore!','Prosimo, izpolnite vsa vnosna polja!']; var field_not_full = ['Bitte füllen Sie das Eingabefeld aus!', 'Rempliez le champ de saisie, s´il vous plaît!','Compilate il campo di inserimento, per favore!','Prosimo, izpolnite vnosno polje!']; var change_question = ['Ändern in: ','Modifier: ','Modificare: ','Spremeni v: ']; //change_question[current_language] /** * Initializes Ajax calls when document is loaded. * @function starts the initial ajax calls when the site has loaded. * @async */ jQuery(document).on('ready', function(){ jQuery('#custom_backdrop').show(); /** * Initiating the async calls to server. * @async * @function gets information about the user from the server * @return {Array} user_data */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'request_user_data', }, success : function( response ) { declare_user_data(JSON.parse(response)); /** * Get number of importain concepts. * @async * @function gets information about the importaint concepts * @return {Array} important_concepts_count */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getConceptCount', }, success : function( response ) { important_concepts_count = JSON.parse(response); /** * Get all images links from server. * @async * @function gets image links * @return {Array} images */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getImage', }, success : function( response ) { images = JSON.parse(response); /** * Get and display AlpenKonventione Polygon * @namespace Ajaxs Calls * @async * @function gets alpine convention borders * @return {Array} border coordinates */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getBordersGeoData', geoData : 'alpenKonvention' }, success : function( response ) { addGeometryAlps(response); initTool(); } }); //konvention } }); } }); } }); }); //document ready /** * Gets values from all answer-input fields and performs an ajax call with the user's answer to be saved in the database. Performs all checks if all fields are filled correctly. And places a marker when the input is saved in the database. * @function saveWord */ function saveWord(){ var input_word = jQuery(&quot;#user_input&quot;).val(); var location = jQuery('#location_span').html(); var location_id = jQuery('#location_span').attr('data-id_location'); var concept = jQuery('#word_span').html(); var concept_id = jQuery('#word_span').attr('data-id_concept'); var concept_index = concepts_index_by_id[concept_id].index; /*Check if fields for Konzept and Region are filled*/ if(input_word.localeCompare(&quot;&quot;) != 0 &amp;&amp; location_id != null &amp;&amp; concept_selected == true){ stage = 5; jQuery('#submitanswer').popover('hide'); var answer = {concept: concept, user_input : input_word , location: location, location_id:location_id }; if(!isDuplicate_indexed(answer)){ /** * Gets user's ID. Used to generate a unique crowder_id cookie, when the user submits an answer. * @async * @function getUserID */ jQuery.ajax({ url : ajax_object.ajax_url , type : 'POST', data : { action : 'getUserID', }, success : function( response ) { if(current_user==null)current_user = JSON.parse(response); createCookie(&quot;crowder_id&quot;,current_user); /** * Send all data(location, location id, concept, concept id, user answer and current user id(not logged in users) or user name(logged in users)) to server. * @function save_word_async * @async */ jQuery.ajax({ url : ajax_object.ajax_url , type : 'POST', data : { action : 'saveWord', gemeinde : location, gemeinde_id : location_id, konzept : concept, konzept_Id : concept_id, bezeichnung : input_word, current_user : current_user }, beforeSend: function(){ }, success : function( response ) { var id_aeusserung = JSON.parse(response); if(id_aeusserung == null) return; jQuery('#image_modal').modal('hide'); /** * Load the location's polygon to be displayed on the map, when user's answer is successfully saved to the database. * @function load_location_polygon * @async */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getChoosenGemeinde', location_id : location_id, searchedGemeinde : location, concept : concept, concept_id : concept_id, bezeichnung : input_word }, success : function( response ) { session_answer_count ++; if(!userLoggedIn)checkLoginPopUp(); var answer = {concept: concept, user_input : input_word , location: location, id_auesserung: id_aeusserung,concept_id:concept_id,concept_index:concept_index}; submitedAnswers.push(answer); submitedAnswers_indexed[id_aeusserung]= answer; delete unanswered_concepts[concept_index]; var entry = {}; entry[id_aeusserung] = {author: current_user , id_aeusserung:id_aeusserung.toString(), id_concept:concept_id, id_geo:location_id, konzept:concept, ortsname:location, word:input_word, tokenisiert:&quot;0&quot;}; if(aeusserungen_by_locationindex[location_id]==null){ aeusserungen_by_locationindex[location_id] = entry; } else{ aeusserungen_by_locationindex[location_id][id_aeusserung] = {author: current_user , id_aeusserung:id_aeusserung.toString(), id_concept:concept_id, id_geo:location_id, konzept:concept, ortsname:location, word:input_word, tokenisiert:&quot;0&quot;}; } add_user_marker(JSON.parse(response),id_aeusserung); change_feature_style(old_feature,check_user_aesserungen_in_location(location)); setTimeout(function() { if(location_markers[location_id]){ change_marker(location_markers[location_id],1,&quot;green&quot;); }else{ var obj = JSON.parse(response); var element = {count:&quot;1&quot;, geo_data:{geo:obj.centerCoordinates,location_id:obj.location_id,userCheck:true}}; display_location_markers(element); } }, 300); jQuery('#word_span').data(&quot;id_concept&quot;,null); jQuery('.row_1').fadeOut().fadeIn(); jQuery('.row_2').fadeOut(function(){ jQuery('#submitanswer').popover('hide'); jQuery('#user_input').val(&quot;&quot;); jQuery('#word_span').text(the_word_concept[current_language]); setTimeout(function() { jQuery('#word_span').popover('show'); jQuery('.pop_word_span').parent().on('click',function(){ handleWordSpanClick(); }).addClass('c_hover'); }, 1000); process_restarted = true; }).fadeIn(); concept_selected = false; word_entered = false; stage = 3; deSelectTableEntry(concept_index); var entry = num_of_answers_by_id[parseInt(concept_id)]; if(entry==null) num_of_answers_by_id[parseInt(concept_id)] = 1; else num_of_answers_by_id[parseInt(concept_id)] +=1; checkTableEntry(concept_id); var row = jQuery(datatable_concepts.row(concept_index).node()); if(row.find('.num_of_answers').length==0){ row.find('.dataparent').append(jQuery('&lt;div class=&quot;num_of_answers&quot;&gt;1&lt;/div&gt;')); } else{ row.find('.num_of_answers').text(num_of_answers_by_id[parseInt(concept_id)]); } current_concept_index = -1; var ua = navigator.userAgent.toLowerCase(); var isAndroid = ua.indexOf(&quot;android&quot;) &gt; -1; if(isAndroid) { map.panTo(location_markers[location_id].getPosition()); } } }); } }); }}); }else{ for (var key in submitedAnswers_indexed) { if (submitedAnswers_indexed.hasOwnProperty(key)) { if(input_word.localeCompare(submitedAnswers_indexed[key].user_input) == 0 &amp;&amp; concept.localeCompare(submitedAnswers_indexed[key].concept) == 0){ var id_auesserung = submitedAnswers_indexed[key].id_auesserung; var concept_id = submitedAnswers_indexed[key].concept_id; //console.log(&quot;AEUSSERUNG ID: &quot; + id_auesserung); break; } } } editInputA(id_auesserung,concept_id,location_id,concept,false); } }else{ jQuery('.message_modal_content').text(user_input_not_full[current_language]); jQuery('#message_modal').modal({ backdrop: 'static', keyboard: false }); } } /** * Loops through all submitted answers and performs fill_answers() on each of them. * @param {Array} array_submitted_answers An array containg submited answers by the user. * */ function fill_submitted_answers(array_submitted_answers){ for(var i = 0; i &lt; array_submitted_answers.length; i++) { var obj = array_submitted_answers[i]; fill_answers(obj); } } /** * Adds an object, containing - Concept(and id), submited answer(and id), location and author of the submitted answer, to submitedAnswers(global array). * @param {Object} obj Contains a single concept-submitted entry, that the user has previously created. * */ function fill_answers(obj){ var concept_id = obj.id_concept; var concept = obj.konzept; var word_inputed = obj.word; var location_name = obj.ortsname; var id_auesserung = obj.id_aeusserung; var author = obj.author; if(author.localeCompare(current_user) == 0 &amp;&amp; author.localeCompare(&quot;anonymousCrowder_90322&quot;) != 0){ var concept_idx = concepts_index_by_id[parseInt(concept_id)].index; var answer = {concept: concept, user_input : word_inputed , location: location_name , id_auesserung: id_auesserung ,concept_id:concept_id,concept_index:concept_idx}; submitedAnswers.push(answer); } } /** * Creates a indexed array. * @param arrayA {Array} Input Array * @param can_edit {Boolean} Checks if the user can edit this entry. * @return {Array} indexed Array */ function create_submited_answers_index_array(arrayA,can_edit){ var result = {}; var is_admin = can_edit; for(var i = 0; i &lt; arrayA.length; i++) { var obj = arrayA[i]; var concept_id = obj.id_concept; var concept = obj.konzept; var word_inputed = obj.word; var location_name = obj.ortsname; var id_auesserung = obj.id_aeusserung; var author = obj.author; if((author.localeCompare(current_user) == 0 &amp;&amp; author.localeCompare(&quot;anonymousCrowder_90322&quot;) != 0) || is_admin){ var concept_idx = concepts_index_by_id[parseInt(concept_id)].index; var answer = {concept: concept, user_input : word_inputed , location: location_name , id_auesserung: id_auesserung ,concept_id:concept_id,concept_index:concept_idx}; result[parseInt(id_auesserung)] = answer; } } return result; } /** * Display markers for each location and the corresponding number of answers in each one. * @param {Array} arrayA Indexed array(index: location id) of each location(name, center point). * @param {Boolean} can_edit Checks if the user can edit the answers(Only for admins). * */ function get_aeussetungen_locations_curLang(arrayA,can_edit){ for (var key in arrayA) { if (arrayA.hasOwnProperty(key)) { if(arrayA[key].count!=null)display_location_markers(arrayA[key],can_edit); } } jQuery('#custom_backdrop').fadeOut('slow',function(){ //if(language_is_set)jQuery('#welcomeback_modal').modal('hide'); }); } /** * Build an indexed array(index location id), containing all answers(type: aeusserung, id_aeusserung, author, ortsname(location), word) submitted by the users. * @param {Array} aeusserungen Array with all answers by users. * @return {Array} Indexed array(location id: [answers]) */ function build_indexed_aeusserungen_array(aeusserungen){ var result = {}; for(var i=0;i&lt;aeusserungen.length;i++){ var entry = {}; entry[aeusserungen[i].id_aeusserung] = aeusserungen[i]; if(result[parseInt(aeusserungen[i].id_geo)]==null){ result[parseInt(aeusserungen[i].id_geo)] = entry; } else{ result[parseInt(aeusserungen[i].id_geo)][aeusserungen[i].id_aeusserung] = aeusserungen[i]; } } return result; } /** * created html element, which will be used in editInput() * @see editInput() in content_interaction.js * @return {String} HTML */ function returnChangeInput(){ var output = [ &quot;&lt;div id='inputWrapper'&gt;&quot;, /*&quot;Sie haben gesagt: In &quot; + ort + &quot; sagt man zu &quot; + concept + &quot; &quot; + auesserung ,*/ /* &quot;&quot; + translateInfoWindowText(ort, concept,auesserung, current_user) + &quot;&quot;, */ &quot;&quot; + &quot;&lt;div style='display:inline-block;margin-right:10px;margin-bottom:5px;'&gt;&quot; + change_question[current_language] + &quot;&lt;/div&gt;&quot;, &quot;&lt;div style='display:inline-block;width:100%'&gt;&lt;input style='width:100%; margin-right:10px;display:inline-block;' id='userAuesserungInput' type='text'/&gt;&lt;/div&gt;&quot;, &quot;&lt;div style='display:block;margin-top:10px;'&gt;&lt;button style='display:inline-block;margin-right:10px;padding:5px;' class='btn btn-primary' id='updateAuesserung' type='button'&gt;&quot; + change_input[current_language] + &quot;&lt;/button&gt;&quot;, &quot;&lt;/div&gt;&quot;, /*&quot;&lt;button style='display:inline-block;padding:5px;' class='btn btn-primary ' data-concept_id=\\&quot;&quot; + id_concept + &quot;\\&quot; data-todelete=\\&quot;&quot; + id_auesserung + &quot;\\&quot; data-ort= \\&quot;&quot; + ort + &quot;\\&quot; type='button' id='deleteAuesserung' type='button' onclick='deleteInput()'&gt;&quot; + delete_input[current_language] + &quot;&lt;/button&gt;*/ &quot;&lt;/div&gt;&quot; ].join(&quot;&quot;); // onclick='updateInput()' return output; } /** * Updated user's answer(Used by editInputA()). * @see editInputA() in generateMap.js * @param {String} concept Concept name * @param {Integer} id_auesserung Id of the submited answer * @param {Integer} concept_id Concept Id * @param {Integer} id_location Location Id * @param {Integer} row_to_update The row number from the data table that will be updated * */ function updateInput(concept, id_auesserung,concept_id,id_location,row_to_update){ console.log(&quot;Send&quot;); var new_auesserung = jQuery('#userAuesserungInput').val(); var stop = false; for (var key in submitedAnswers_indexed) { var oldanswer = submitedAnswers_indexed[key].user_input; if(oldanswer==new_auesserung)stop=true; } if(new_auesserung.localeCompare(&quot;&quot;) != 0 &amp;&amp; !stop){ if(row_to_update){ row_to_update.find('td:nth-child(2)').first().text(&quot;\\&quot;&quot;+new_auesserung+&quot;\\&quot;&quot;); } updateAnswers_indexed(id_auesserung,new_auesserung,id_location); jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'updateAuesserung', id_auesserung : id_auesserung, new_auesserung : new_auesserung }, success : function( response ) { //console.log(response); // updateSuccess(id_auesserung,new_auesserung,concept); // var answer = {concept: concept, user_input : new_auesserung , location: ort, id_auesserung: id_auesserung}; } }); jQuery('#input_modal').modal('hide'); }else{ markInputRed(jQuery('#userAuesserungInput')); } } /** * Sends an Ajax call to delete answer from the server. * @param {Integer} id_auesserung Submited answer Id * @param {String} ort Location name * @param {Integer} concept_id Concept Id * @param {Integer} location_id Location Id * */ function deleteInput(id_auesserung, ort, concept_id, location_id){ deleteFromAnswers_indexed(id_auesserung, location_id); change_marker(location_markers[location_id],-1,&quot;green&quot;); num_of_answers_by_id[concept_id]--; if(num_of_answers_by_id[concept_id]==0){ deleteFromConceptTable(concept_id); } else{ checkTableEntry(concept_id); } jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'deleteAuesserung', id_auesserung : id_auesserung, ort : ort, gemeinde_id : location_id, current_user : current_user }, success : function( response ) { /*If informant was deleted from db and has no other submited answers, delete cookie and current_user*/ var user_deleted = JSON.parse(response); if(user_deleted &amp;&amp; isEmpty(submitedAnswers_indexed) &amp;&amp; !userLoggedIn){ eraseCookie(&quot;crowder_id&quot;); current_user = null; } } }); if(old_feature != null &amp;&amp; ort.localeCompare(old_feature.getProperty('location')) == 0 ) { change_feature_style(old_feature,check_user_aesserungen_in_location(ort)); } } /** * Delete user's answer from submitedAnswers_indexed and aeusserungen_by_locationindex. * @param {Int} id_auesserung Submited answer Id * @param {Int} id_location Location Id * */ function deleteFromAnswers_indexed(id_auesserung,id_location){ delete submitedAnswers_indexed[id_auesserung]; delete aeusserungen_by_locationindex[id_location][id_auesserung]; } /** * Update user's answer in submitedAnswers_indexed and aeusserungen_by_locationindex. * @param {Int} id_auesserung Submited answer Id * @param {String} input User's Input * @param {Int} id_location Location Id * */ function updateAnswers_indexed(id_auesserung,input,id_location){ submitedAnswers_indexed[id_auesserung].user_input = input; aeusserungen_by_locationindex[id_location][id_auesserung].word = input; } // function updateSuccess(id_auesserung,new_auesserung,concept,marker){ // for(var i = 0; i &lt; markers.length; i++){ // if(marker === markers[i].marker){ // var auesserung_id = marker.id_auesserung; // var ort = marker.location; // var concept = marker.concept; // var point = marker.getPosition(); // var concept_id = marker.concept_id; // } // } // jQuery('#input_modal').modal('hide'); // } /** * [deleteFromConceptTable description] * @param {Int} _concept_id [description] * */ function deleteFromConceptTable(_concept_id){ var table_index_t = concepts_index_by_id[parseInt(_concept_id)].index; var name = concepts_index_by_id[parseInt(_concept_id)].name; var row = datatable_concepts.row(table_index_t).node(); jQuery(row).removeClass('green_row'); jQuery(row).find('.num_of_answers').remove(); jQuery(row).find('.dataspan').find('.fa-check').remove(); if(table_index_t&lt;important_concepts_count){ var icon = jQuery('&lt;i class=&quot;fa fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'); jQuery(row).find('.dataspan').prepend(icon); } unanswered_concepts[table_index_t] = concepts_cur_lang[table_index_t]; //add concept back to unanswered list; } /** * [checkTableEntry description] * @param {Int} _concept_id [description] * */ function checkTableEntry(_concept_id){ var table_index_t = concepts_index_by_id[parseInt(_concept_id)].index; var row = datatable_concepts.row(table_index_t).node(); jQuery(row).addClass('green_row'); var icon = jQuery('&lt;i class=&quot;fa fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'); if(jQuery(row).find('.fa-check').length==0){ jQuery(row).find('.dataspan').prepend(icon); } jQuery(row).find('.fa-exclamation-triangle').remove(); if(jQuery(row).find('.num_of_answers').length==0){ jQuery(row).find('.dataparent').append(jQuery('&lt;div class=&quot;num_of_answers&quot;&gt;1&lt;/div&gt;')); } else{ jQuery(row).find('.num_of_answers').text(num_of_answers_by_id[parseInt(_concept_id)]); } } /** * [selectTableEntry description] * @param {Int} table_index index of the selected entry in the data table * */ function selectTableEntry(table_index){ var row = datatable_concepts.row(table_index).node(); // console.log(datatable_concepts.row(table_index)); jQuery(row).addClass('concept-list-select-tr'); jQuery(row).find('.dataparent').addClass('list_selected_concept'); if(table_index&gt;=important_concepts_count){ var icon = jQuery('&lt;i class=&quot;fa fa-arrow-right list-select-arrow&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'); if(jQuery(row).find('.fa-arrow-right').length==0){ jQuery(row).find('.dataspan').prepend(icon); } } } /** * [deSelectTableEntry description] * @param {Int} table_index [description] * */ function deSelectTableEntry(table_index){ var row = datatable_concepts.row(table_index).node(); jQuery(row).removeClass('concept-list-select-tr'); jQuery(row).find('.list_selected_concept').removeClass('list_selected_concept'); if(table_index&gt;=important_concepts_count){ jQuery(row).find('.list-select-arrow').remove(); } } function checkEnteredConcepts(){ for(var i=0;i&lt;submitedAnswers.length;i++){ checkTableEntry(submitedAnswers[i].concept_id); } } /** * [checkEnteredConcepts_indexed description] * */ function checkEnteredConcepts_indexed(){ for (var key in submitedAnswers_indexed) { if (submitedAnswers_indexed.hasOwnProperty(key)) { checkTableEntry(submitedAnswers_indexed[key].concept_id); } } } /** * Marks the input field red if user tries to submit the same answer or an empty field, when changing his answer. * @param {String} input [description] * */ function markInputRed(input){ /*input field turns red for 1 sec*/ input.css('border-color', 'red'); //.addClass( &quot;myClass yourClass&quot; ); input.css('background-color', 'rgb(224, 143, 143)'); setTimeout(function(){ input.css('border-color', 'white'); input.css('background-color', 'white'); }, 1000); /* jQuery('#editInput_modal').modal({ keyboard: true }); jQuery('.editInput_modal_content').html(&quot;&lt;div&gt;&quot; + field_not_full[current_language] + &quot;&lt;/div&gt;&quot;);*/ } function showElement(n){ var images = document.getElementsByClassName('images'); images[n].style.display = 'block'; //console.log(images); } function isDuplicate(answer){ //var answer = {concept: concept, user_input : input_word , location: location}; var exists = false; for(var i = 0; i&lt;submitedAnswers.length;i++){ var cnt = submitedAnswers[i].concept; var input = submitedAnswers[i].user_input; var lct = submitedAnswers[i].location; if(input.localeCompare(answer.user_input) == 0 &amp;&amp; lct.localeCompare(answer.location) == 0 &amp;&amp; cnt.localeCompare(answer.concept) == 0){ exists = true; break; } } return exists; } /** * Checks if the user's answer is a dublicate(he has already entered the same answer for the same concept in that location). * @param {Array} answer [description] * @return {Boolean} [description] */ function isDuplicate_indexed(answer){ //var answer = {concept: concept, user_input : input_word , location: location}; var exists = false; for(var key in submitedAnswers_indexed){ if (submitedAnswers_indexed.hasOwnProperty(key)) { var cnt = submitedAnswers_indexed[key].concept; var input = submitedAnswers_indexed[key].user_input; var lct = submitedAnswers_indexed[key].location; var lct_id = submitedAnswers_indexed[key].location_id; if(input.localeCompare(answer.user_input) == 0 &amp;&amp; lct.localeCompare(answer.location) == 0 &amp;&amp; cnt.localeCompare(answer.concept) == 0){ exists = true; break; } } } return exists; } /** * check if string contains a substring * @param {String} needle [description] * */ var contains = function(needle) { // Per spec, the way to identify NaN is that it is not equal to itself var findNaN = needle !== needle; var indexOf; if(!findNaN &amp;&amp; typeof Array.prototype.indexOf === 'function') { indexOf = Array.prototype.indexOf; } else { indexOf = function(needle) { var i = -1, index = -1; for(i = 0; i &lt; this.length; i++) { var item = this[i]; if((findNaN &amp;&amp; item !== item) || item === needle) { index = i; break; } } return index; }; } return indexOf.call(this, needle) &gt; -1; }; /** * Creates a cookie with name, value and exp. date * @param {String} name [description] * @param {String} value [description] * @param {Int} days [description] * */ function createCookie(name,value,days) { if (days) { var date = new Date(); date.setTime(date.getTime()+(days*24*60*60*1000)); var expires = &quot;; expires=&quot;+date.toGMTString(); } else var expires = &quot;&quot;; document.cookie = name+&quot;=&quot;+value+expires+&quot;; path=/&quot;; } /** * Read value of a cookie by name. * @param {String} name [description] * @return {String} [description] */ function readCookie(name) { var nameEQ = name + &quot;=&quot;; var ca = document.cookie.split(';'); for(var i=0;i &lt; ca.length;i++) { var c = ca[i]; while (c.charAt(0)==' ') c = c.substring(1,c.length); if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length); } return null; } /** * Delete cookie. * @param {String} name [description] * */ function eraseCookie(name) { createCookie(name,&quot;&quot;,-1); } /** * Check if an object is empty. * @param {Object} obj [description] * @return {Boolean} [description] */ function isEmpty(obj) { for(var prop in obj) { if(obj.hasOwnProperty(prop)) return false; } return true; } /** * Saves the choosen language of the user in the database. * @param {String} user_name [description] * */ function userRegisterDone(user_name){ //console.log(data); jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'save_user_language', user_lang : current_language, anonymous_id : current_user, user_name : user_name }, success : function( response ) { console.log(&quot;Language Added&quot;); console.log(JSON.parse(response)); } }); } /** * Saves user data in global variables. * @param {Object} obj [description] * */ function declare_user_data(obj){ userLoggedIn = obj.userLoggedIn; if(userLoggedIn){ language_is_set = obj.language_is_set ; anonymousCrowder = false ; current_user = obj.current_user ; crowder_lang = obj.crowder_lang; user_email = obj.user_email; }else{ language_is_set = obj.language_is_set ; anonymousCrowder = true; current_user = obj.current_user; crowder_lang = null; } //console.log(obj); } /** * Check if user(only for not logged in users) has submited answers and delete crowder_id cookie if he has no answers. * */ function check_user_aeusserungen(){ if(isEmpty(submitedAnswers_indexed) &amp;&amp; !userLoggedIn){ eraseCookie(&quot;crowder_id&quot;); current_user = null; } } /** * Checks if the user has any answers in the current location. This is used for changing the color of the location marker: blue - user has not entered a answer in the location, green - user has entered an answer in that location. * @param {String} location [description] * */ function check_user_aesserungen_in_location(location){ var has_aeusserungen = false; for (var key in submitedAnswers_indexed) { if (submitedAnswers_indexed.hasOwnProperty(key)) { if(location.localeCompare(submitedAnswers_indexed[key].location) == 0){ has_aeusserungen = true; break; } } } return has_aeusserungen; } × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"content_interactions.js.html":{"id":"content_interactions.js.html","title":"Source: content_interactions.js","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Source: content_interactions.js /** * @module Content_Interactions * * */ var welcome_texts = [&quot;Willkommen.&quot;,&quot;Bienvenue.&quot;,&quot;Benvenuto.&quot;,&quot;Dobrodoš​‌li.&quot;]; var slogan_texts = [&quot;Sprich die Sprache der Alpen!&quot;,&quot;Parlons la langue des Alpes!&quot;,&quot;Parliamo la lingua delle Alpi!&quot;,&quot;Govori jezik Alp!&quot;]; var language_texts = [&quot;Sprache ...&quot;,&quot;Langue ...&quot;,&quot;Lingua ...&quot;,&quot;Jezik ...&quot;]; var languages = [&quot;Deutsch&quot;,&quot;Français&quot;,&quot;Italiano&quot;,&quot;Slovenščina&quot;]; var instruction_texts =[ 'Verraten Sie uns, wie Sie zu bestimmten almwirtschaftlichen Begriffen sagen! Wählen Sie dazu Ihre Gemeinde und einen der vorgegebenen Begriffe aus und tragen Sie im Antwortfeld eine Bezeichnung ein. Vor besonders wichtigen Begriffen steht ein “!“. Die von Ihnen eingetragenen Wörter werden auf der Karte in grün markiert; die Wörter von anderen Personen sind blau markiert. Durch Klick auf den jeweiligen Eintrag können Sie diesen ändern oder löschen. Setzen Sie eventuelle Anmerkungen bitte in Klammern! Falls nötig, können Sie mehrere Bezeichnungen nennen und diese durch ein Komma trennen. Wir würden uns freuen, wenn Sie sich im Anschluss registrieren würden, um ihre Ergebnisse zu speichern. Je mehr Wörter Sie eintragen, umso besser - und kommen Sie jederzeit gerne wieder!', 'Aidez-nous à mieux connaître le langage alpin! Sélectionnez votre commune et un des concepts proposés; insérez ensuite le mot dialectal dans la case réponse. Devant des concepts particulièrement importants se trouve un “!”. Les mots que vous insérez apparaissent sur la carte sous forme de symboles verts; les mots insérés par d\\'autres personnes sont symbolisés en bleu. Mettez des commentaires éventuels entre parenthèses, s´il vous plaît! Si nécessaire, vous pouvez insérer plusieurs mots et les séparer par une virgule. Enfin, nous vous remercierions de vous enregistrer pour mémoriser vos résultats. Plus mots vous insérez, mieux c`est - Vous serez toujours le bienvenu à la page!', 'Aiutateci a conoscere meglio il linguaggio alpino! Scegliete il vostro comune e uno dei concetti proposti e inserite la parola dialettale nel campo risposta. Davanti a concetti di particolare importanza si trova un “!”. Le parole che inserite appariranno sulla carta evidenziate in verde; le parole inserite da altre persone sono evidenziate in blu. Cliccando su vostro contributo potete cambiarlo o cancellarlo. Mettete eventuali commenti fra parentesi, per favore! Se necessario, potete inserire parecchie parole e separarle con una virgola. Poi saremmo lieti se vi registrate per memorizzare i vostri risultati. Più parole inserite, meglio è - Siete sempre benvenuti ogni volta che tornate sul sito!', 'Pomagajte nam bolje spoznati alpski jezik! Izberite svoj kraj in enega od danih pojmov ter v polje za odgovor vnesite oznako. Pred posebno pomembnimi pojmi se nahaja ”!”. Besede, ki jih boste vnesli, bodo na karti prikazane zeleno; odgovori drugih oseb bodo modre barve. Klikajoč konkreten vpis lahko ga spremenite ali izbrišete. Prosimo, da morebitne pripombe postavite v oklepaje. Če je potrebno, jih lahko označite več in jih med seboj ločite z vejico. Prosimo, da se na koncu registrirate in tako shranite svoje podatke. Čim več konceptov vnesete tem bolje -in se vračajte k nam kadarkoli!'] var instruction_heads = [ &quot;Anleitung&quot;, &quot;Instructions&quot;, &quot;Istruzioni&quot;, &quot;Navodila&quot; ] var go_texts = [ &quot;Los geht's&quot;, &quot;Allons-y!&quot;, &quot;Via!&quot;, &quot;Gremo!&quot; ] var the_word_concept = [ &quot;Begriff&quot;, &quot;concept&quot;, &quot;concetto&quot;, &quot;reče&quot; ] var concept_select_texts = [ &quot;Wählen Sie einen Begriff aus.&quot;, &quot;Sélectionnez un mot.&quot;, &quot;Scegliete una parola.&quot;, &quot;Izberite pojem!&quot; ] var input_select_texts = [ &quot;Tragen Sie eine Antwort ein.&quot;, &quot;Insérez une réponse.&quot;, &quot;Inserite una risposta.&quot;, &quot;Vnesite odgovor!&quot; ]; var location_select_texts = [ &quot;Wählen Sie eine Gemeinde aus.&quot;, &quot;Sélectionnez une commune.&quot;, &quot;Scegliete un comune.&quot;, &quot;Izberite občino!&quot; ]; var location_select_texts_with_br = [ &quot;Wählen Sie eine &lt;br&gt; Gemeinde aus.&quot;, &quot;Sélectionnez &lt;br&gt; une commune.&quot;, &quot;Scegliete &lt;br&gt; un comune.&quot;, &quot;Izberite občino!&quot; ]; var submit_texts = [ &quot;Abschicken!&quot;, &quot;Envoyer!&quot;, &quot;Inviare!&quot;, &quot;Pošlij!&quot; ]; var anonymous_texts =[ &quot;Anonym&quot;, &quot;Anonyme&quot;, &quot;Anonimo&quot;, &quot;Anonimen&quot; ] var important_concepts_texts = [ &quot;Wichtiger Begriff&quot;, &quot;Concept important&quot;, &quot;Concetto importante&quot;, &quot;Važni pojem&quot; ] var tooltips = [ {name:&quot;#word_span&quot;,array:concept_select_texts}, {name:&quot;#location_span&quot;,array:location_select_texts}, {name:&quot;#user_input&quot;,array:input_select_texts}, {name:&quot;#submitanswer&quot;,array:submit_texts}, ]; var leftmenu_contents = [ &quot;#left_menu_content_ger&quot;, &quot;#left_menu_content_fr&quot;, &quot;#left_menu_content_ita&quot;, &quot;#left_menu_content_slo&quot; ]; var welcomeback_texts =[ &quot;Willkommen &lt;br&gt; zurück.&quot;, &quot;Merci d\\'être &lt;br&gt; revenu!&quot;, &quot;Grazie di &lt;br&gt; essere tornato! &quot;, &quot;Dobrodošli &lt;br&gt; ponovno!&quot; ] var register_texts = [ &quot;Jetzt anmelden!&quot;, &quot;Enregistrer / Login&quot;, &quot;Registrare / Login&quot;, &quot;Registracija / Prijava&quot; ] var random_texts =[ &quot;Zufälliger Begriff&quot;, &quot;Concept aléatoire&quot;, &quot;Concetto casuale&quot;, &quot;Naključen pojem&quot; ] var suggest_texts = [ &quot;Begriff vorschlagen&quot;, &quot;Proposer un concept&quot;, &quot;Proporre un concetto&quot;, &quot;Predlagaj pojem&quot; ] var active_user_texts =[ &quot;Aktivste User&quot;, &quot;Participants les plus actifs&quot;, &quot;Partecipanti i più attivi&quot;, &quot;Najbolj aktivni uporabniki&quot; ] var active_location_texts =[ &quot;Aktivste Gemeinden&quot;, &quot;Communes les plus actives&quot;, &quot;Comuni i più attivi&quot;, &quot;Najbolj aktivne občine &quot; ] var active_concept_texts =[ &quot;Beliebteste Begriffe&quot;, &quot;Concepts les plus populaires&quot;, &quot;Communes les plus actives&quot;, &quot;Najbolj priljubljeni pojmi&quot; ] var register_head_texts = [ &quot;Warum Registrieren?&quot;, &quot;Pourquoi enregistrer?&quot;, &quot;Perché registrare?&quot;, &quot;Zakaj registracija? &quot; ] var register_body_texts = [ &quot;Sie haben dauerhaften Zugriff auf Ihre Daten. &lt;br&gt; Sie können VerbaAlpina Champion werden. &lt;br&gt; Sie erhalten aktuelle Infos über neue Funktionen und die Community. &lt;br&gt; Sie können neue Begriffe vorschlagen.&quot;, &quot;Vous avez accès permanent à vos données. &lt;br&gt; Vous pouvez devenir champion de VerbaAlpina. &lt;br&gt; Vous recevez des informations actuelles sur des fonctions nouvelles et la communauté de VerbaAlpina. &lt;br&gt; Vous pouvez proposer des concepts nouveaux.&quot;, &quot;Avete accesso permanente ai vostri dati. &lt;br&gt; Potete diventare campione di VerbaAlpina. &lt;br&gt; Ricevete informazioni attuali su nuove funzioni e la communità di VerbaAlpina. &lt;br&gt; Potete proporre nuovi concetti.&quot;, &quot;Omogoča stalen dostop do vaših podatkov. &lt;br&gt; Lahko postanete zmagovalec/ka VerbaAlpine. &lt;br&gt; Z registracijo boste prejemali aktualne informacije o novih funkcijah spletne strani in skupnosti VerbaAlpina. &lt;br&gt; Lahko predlagate nove pojme.&quot; ] var register_yes_texts = [ &quot;Jetzt registrieren!&quot;, &quot;Enregistrer maintenant!&quot;, &quot;Registrare adesso!&quot;, &quot;Registrirajte se zdaj!&quot; ] var register_no_texts = [ &quot;Nein, Danke!&quot;, &quot;Non, merci!&quot;, &quot;No, grazie!&quot;, &quot;Ne, hvala!&quot; ] var feedback_texts = [ &quot;Danke, Ihr Vorschlag wird geprüft!&quot;, &quot;Grazie, la vostra proposta viene esaminata!&quot;, &quot;Merci, votre proposition est examinée!&quot;, &quot;Thank you, your proposal will be checked!&quot; ] var permanently_saved = [ &quot;Dauerhaft gespeichert&quot;, &quot;Mémorisé de manière permanente&quot;, &quot;Memorizzato permanentemente&quot;, &quot;Saved Permanently&quot; ]; var break_cycle = false; /** * Saves the language choosen by the user from the modal. 0 - German, 1 - French, 2 - Italian, 3 - Slovenian * @type {Number} */ var current_language = 0; var selectbox; /** * Array of all concepts and their ids in the current language choosen. * @type {Array} */ var concepts_cur_lang; /** * An indexed array containing concept name and the concept id as the array index. */ var concepts_index_by_id; /** * Index array of user entered answers. Index - Concept Id, Number of user Input of the assosiated concept. */ var num_of_answers_by_id; /** * Array with all data for the locations data table. * @type {Array} */ var location_data; var allow_select = false; var offsetHeight = 0; var old_doc_width =0; var modals_initialized = false; var locations_modal_modals_initialized=false; var concepts_modal_initialized = false; var do_image_modal; var tutorial_running = false; var location_selected = false; var concept_selected = false; var word_entered =false; var stage = 0; var process_restarted = false; var centerCoordinates_locations = []; var saved_location_index = -1; var saved_location_name; var current_concept_index = -1; var geo_data; var aeusserungen_test; var count_aeusserung_per_location; var indexed_location_aeusserungen_array; var aeusserungen_by_locationindex; var unanswered_concepts; var current_location_list_table_data; var current_location_list_table; var current_location_list_object; var prevent_randomclick = false; var datatable_locations; var datatable_concepts; var session_answer_count =0; var top_locations; var top_concepts; var top_users; var current_highscoredata; var current_top_list_table; var prevent_backdrop = false; /** * Initializes UI elements according to the browser. Sets the map in the center of the browser. * */ function initTool(){ // google.maps.event.addListener(map, 'dragend', function() { console.log(map.getCenter().lat()); console.log(map.getCenter().lng());} ); // var left_menu = document.getElementById('left_menu'); // map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(left_menu); /*console.log(current_user); console.log(&quot;Language is set: &quot; + language_is_set);*/ calculateCenter(); offsetHeight = jQuery('#left_menu').outerHeight(); google.maps.event.addDomListener(window, 'resize', function() { map.setCenter(center); setDynamicContent(); }); addModalListeners(); /* if(!language_is_set){ current_language=-1; initWelcomeModal(); jQuery('#welcome_modal').modal({ backdrop: 'static', keyboard: false }) console.log(language_is_set); }else{ setRandomTitelImage(); jQuery('#welcomeback_modal').find('#modal_welcome').html(welcomeback_texts[current_language]); jQuery('#welcomeback_modal').modal({ keyboard: false }) console.log(language_is_set); }*/ if(language_is_set){ current_language = parseInt(crowder_lang); setRandomTitelImage(function(){ jQuery('#welcomeback_modal').find('#modal_welcome').html(welcomeback_texts[current_language]); jQuery('#welcomeback_modal').modal({ keyboard: false }) },&quot;.welcome_modal&quot;); //console.log(&quot;True:&quot; + language_is_set); }else{ current_language=-1; initWelcomeModal(); setRandomTitelImage(function(){ jQuery('#welcome_modal').modal({ backdrop: 'static', keyboard: false }) },&quot;.welcome_modal&quot;); } } /** * Ajusts HTML-Elemets size according to the browser. * */ function setDynamicContent(source){ var doc_width = jQuery(document).width(); var doc_height = jQuery(document).height(); offsetHeight = jQuery('#left_menu').outerHeight(); //update height for leftmenu if(doc_width&lt;=330){ jQuery('#left_menu').css('padding-left',&quot;9px&quot;).css('padding-right',&quot;0px&quot;); jQuery('.row_2').css('text-align','center'); } else{ jQuery('#left_menu').css('padding-left',&quot;20px&quot;).css('padding-right',&quot;20px&quot;); jQuery('.row_2').css('text-align','right'); } if(doc_width&lt;576){ jQuery('.row_1').css('font-size',&quot;17px&quot;); jQuery('.row_2').css('font-size',&quot;17px&quot;).css('margin-left',&quot;0px&quot;); } if(doc_width&gt;1400){ jQuery('.row_1').css('font-size',&quot;48px&quot;); jQuery('.row_2').css('font-size',&quot;48px&quot;); } else if (doc_width&lt;1200&amp;&amp;doc_width&gt;576){ jQuery('.row_1').css('font-size',&quot;3vw&quot;); jQuery('.row_2').css('font-size',&quot;3vw&quot;); } if(jQuery('#image_modal').hasClass('in')){ jQuery('#image_modal').find('.i_fake_body').height('65vh'); var modal_margin = 30; if(doc_width&lt;576) modal_margin = 10; var modal_height = jQuery('#image_modal').find('.i_fake_body').height()+23 + modal_margin; //23 = footer, 30 = margin top var offsetHeight_l = document.getElementById('left_menu').offsetHeight + 20; //20 = before; var margin = 15; if((modal_height+offsetHeight_l) &gt; doc_height) { var dif = doc_height-(modal_height+offsetHeight_l); var current_height = jQuery('#image_modal').find('.i_fake_body').height(); var new_height = current_height+dif-margin; jQuery('#image_modal').find('.i_fake_body').height(new_height); } } if(source!='image') { for(var i=0;i&lt;tooltips.length;i++){ jQuery(tooltips[i].name).popover('dispose'); } addToolTips(tooltips); if(jQuery('.login_popover').parent().parent().hasClass('in')){ jQuery('#icon_login').popover('dispose'); addLoginToolTip(); showLoginPopUp(); } if(jQuery('.list_modal').hasClass('in')){ displayTooltips(false); if(modals_initialized){ reMeasureDatatables(); } } if(doc_width&lt;485){ var offsetstring = &quot;0 0&quot;; if(current_language==0){ if(doc_width&lt;338 &amp;&amp; doc_width&gt;329){offsetstring = &quot;0 -10&quot;;} if(doc_width&lt;323)offsetstring = &quot;0 20&quot;; if(doc_width&lt;307){offsetstring = &quot;0 -25&quot;;} } if(current_language==1){ if(doc_width&lt;451)offsetstring = &quot;0 -20&quot;; } if(current_language==2){ if(doc_width&lt;315)offsetstring = &quot;0 10&quot;; if(doc_width&lt;302)offsetstring = &quot;0 -20&quot;; } jQuery('#location_span').popover('dispose'); jQuery('#location_span').popover({ trigger:&quot;manual&quot;, placement:&quot;top&quot;, container:&quot;body&quot;, html:true, content:'&lt;div class=&quot;pop_location_span custom_popover_content&quot;&gt;'+location_select_texts_with_br[current_language]+'&lt;/div&gt;', offset:offsetstring, animation:true }); if(stage==1){ jQuery('#location_span').popover('show'); jQuery('.pop_location_span').parent().on('click',function(){ handleLocationSpanClick(); }).addClass('c_hover'); } } else{ jQuery('#location_span').popover('dispose'); addToolTip('#location_span',location_select_texts); } if(stage==4){ jQuery('#submitanswer').popover('show'); jQuery('.pop_submitanswer').parent().on('click',function(){ if(!submit_button_clicked){ saveWord(); submit_button_clicked = true; setTimeout(function(){ submit_button_clicked = false; console.log('submit button: After saveword() ' + submit_button_clicked);}, 1000); } }).addClass('c_hover'); } if(source!=&quot;list&quot;)showPopUp(); } if(old_doc_width&gt;575 &amp;&amp;doc_width&lt;575){ reMeasureDatatables(); } else if(old_doc_width&lt;575 &amp;&amp;doc_width&gt;575){ reMeasureDatatables(); } if(doc_width&lt;452){ jQuery('#register_modal .custom-modal-footer button').css('font-size',&quot;10px&quot;); jQuery('#register_modal .modal-body').css('padding-right',&quot;2px&quot;); } else{ jQuery('#register_modal .custom-modal-footer button').css('font-size',&quot;14px&quot;); jQuery('#register_modal .modal-body').css('padding-right',&quot;10px&quot;); } old_doc_width = doc_width; } /** * Initializes the CS-Tool. Performes Ajax Calls to fetch data(locations, user entries) from the server. The gathered data is then stored in global variables. */ function startMainTool(){ create_cookie(current_language); var menu_content = jQuery(leftmenu_contents[current_language]); jQuery('#left_menu').append(menu_content); menu_content.show(); if(!language_is_set)showCustomBackdrop(); jQuery('#submitanswer').on('click', function(){ console.log('submit button: Before saveword() ' + submit_button_clicked); if(!submit_button_clicked){ saveWord(); submit_button_clicked = true; setTimeout(function(){ submit_button_clicked = false; console.log('submit button: After saveword() ' + submit_button_clicked);}, 1000); // console.log( JSON.stringify(submitedAnswers)); } }) /*set user language -&gt; to be saved as current_language in the wp_db*/ if(!language_is_set){ // (crowder_lang/*.localeCompare(&quot;&quot;) == 0*/ || current_language != crowder_lang || /*crowder_lang.localeCompare(&quot;-1&quot;) ||*/ crowder_lang == -1 ) &amp;&amp; userLoggedIn jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'save_lang_for_user', lang : current_language }, success : function( response ) { console.log(&quot;language saved&quot;); console.log(&quot;Saved language: &quot; + JSON.parse(response)); } }); } /*ajax call to get all locations in the choosen language*/ /** * Get locations in current language * @async * @function getTableData */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getlocations', lang : current_language }, success : function( response ) { locations = JSON.parse(response); location_data = getTableData(locations,&quot;location&quot;); initLocationsModal(); /** * Get Aeusserungen and the Manicipilities associated * @async * @function getTableData */ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getAuesserungen_geoData', lang : current_language }, success : function( response ) { var arr = JSON.parse(response); jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'check_user_status', }, success : function( response ) { var can_do = JSON.parse(response); //console.log(can_do); var is_admin = can_do.can_edit; aeusserungen = arr.aeusserungen; count_aeusserung_per_location = arr.locations_aeusserungen_count; indexed_location_aeusserungen_array = arr.locations_aeusserungen_count; get_aeussetungen_locations_curLang(indexed_location_aeusserungen_array,is_admin); aeusserungen_by_locationindex = build_indexed_aeusserungen_array(aeusserungen); fill_submitted_answers(aeusserungen); submitedAnswers_indexed = create_submited_answers_index_array(aeusserungen,is_admin); num_of_answers_by_id = createAnswersToEntryNumbers(submitedAnswers_indexed); checkEnteredConcepts_indexed(); unanswered_concepts = createUnansweredIndex(); if(!userLoggedIn){ addLoginToolTip(); startLoginTimer(); } check_user_aeusserungen(); }}); }}); }}); /*ajax call for all the concepts in the choosen language*/ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getKonzepte', lang : current_language }, success : function( response ) { concepts_cur_lang = JSON.parse(response); concept_data = getTableData(concepts_cur_lang,&quot;concept&quot;); initConceptModal(); allow_select = true; /*console.log('concepts_cur_lang'); console.log(concepts_cur_lang);*/ concepts_index_by_id = createConceptIndexList(concepts_cur_lang); /* console.log('concepts_index_by_id'); console.log(concepts_index_by_id);*/ // google.maps.event.addListener(map, 'mousemove', function (event) { // // displayCoordinates(event.latLng); // }); setDynamicContent(); jQuery('#left_menu').css('opacity','0'); jQuery('#left_menu').show(); offsetHeight = document.getElementById('left_menu').offsetHeight; jQuery('#left_menu').css('bottom',-offsetHeight); jQuery('#left_menu').css('opacity','1'); jQuery('#left_menu').animate({ bottom: '+='+offsetHeight }, 400,'swing', function() { menu_is_up(); }); jQuery('#left_menu').hammer().bind(&quot;swipedown&quot;, function(){ if(jQuery(this).is(':visible')){ jQuery(this).animate({ bottom: '-='+offsetHeight }, 400,'swing',function(){jQuery(this).hide();jQuery('#fake_arrow').show();}); jQuery('.popover').hide(); } }); jQuery('#swipe-up-div').hammer().bind(&quot;swipedown&quot;, function(){ if(jQuery('#left_menu').is(':visible')){ jQuery('#left_menu').animate({ bottom: '-='+offsetHeight }, 400,'swing',function(){jQuery('#left_menu').hide();jQuery('#fake_arrow').show();}); jQuery('.popover').hide(); } }); jQuery('#swipe-up-div').hammer().bind(&quot;swipeup&quot;, function(){ if(jQuery('#left_menu').is(':hidden')){ jQuery('#left_menu').show().animate({ bottom: '+='+offsetHeight }, 400,'swing',function(){jQuery('.popover').show();}); jQuery('#fake_arrow').hide(); } }); jQuery('#fake_arrow').hammer().bind(&quot;swipeup&quot;, function(){ if(jQuery('#left_menu').is(':hidden')){ jQuery('#left_menu').show().animate({ bottom: '+='+offsetHeight }, 400,'swing',function(){jQuery('.popover').show();}); jQuery('#fake_arrow').hide(); } }); jQuery('#left_menu').data(&quot;hammer&quot;).get('swipe').set({direction: Hammer.DIRECTION_ALL}); jQuery('#swipe-up-div').data(&quot;hammer&quot;).get('swipe').set({direction: Hammer.DIRECTION_ALL}); jQuery('#fake_arrow').data(&quot;hammer&quot;).get('swipe').set({direction: Hammer.DIRECTION_ALL}); jQuery('#word_span').on('click',function(){ handleWordSpanClick(); }); jQuery('#location_span').on('click',function(){ handleLocationSpanClick(); }) jQuery('#user_input').on('keyup',function(){ if(process_restarted){closeAllInfoWindows();process_restarted=false;} if(concept_selected &amp;&amp; location_selected &amp;&amp;stage==3){ word_entered = true; setTimeout(function() { showPopUp(); }, 100); } }) } //success }); } /** * Initializes the Modals at the start of the CS-Tool, when the user has not yet choosen a language, has not yet registred. * */ function initWelcomeModal(){ jQuery('#welcome_modal').on('show.bs.modal', function (e) { showCustomModalBackdrop(); selectbox = jQuery('#language_select', this).selectBoxIt({theme: &quot;bootstrap&quot;,defaultText: &quot;Sprache ...&quot;,showFirstOption: false}); jQuery(&quot;.infotext_container&quot;).mCustomScrollbar({ scrollButtons:{enable: true}}); cycleText(jQuery(&quot;#modal_welcome&quot;),welcome_texts,0,function(i){ i-=1; jQuery(&quot;#language_selectSelectBoxItText&quot;).text(language_texts[i]); jQuery(&quot;#language_selectSelectBoxItText&quot;).attr('data-val',language_texts[i]); }); cycleText(jQuery(&quot;#slogan_id&quot;),slogan_texts,0); selectbox.on('open',function(){ if(jQuery('#welcome_modal').find('.modal-content').height()&lt;340) jQuery('.findicators').hide(); }); selectbox.on('close',function(){ jQuery('.findicators').show(); }); selectbox.on('change',function(){ // var select_index = jQuery('#language_selectSelectBoxItOptions').find(&quot;.active&quot;).attr('data-id'); var current_lang; var idx = jQuery(this).val(); jQuery('#testdiv').hide(); var select_index = 0; select_index = languages.indexOf(idx); current_language = select_index; var clone_1; var clone_2; if(!break_cycle){ current_lang = jQuery(&quot;#modal_welcome&quot;).attr('lang_id'); if(current_lang==4)current_lang=0; clone_1 = jQuery(&quot;#modal_welcome&quot;).clone().attr('id','modal_welcome_c'); clone_2 = jQuery(&quot;#slogan_id&quot;).clone().attr('id','slogan_id_c'); jQuery(&quot;#modal_welcome&quot;).replaceWith(clone_1); jQuery(&quot;#slogan_id&quot;).replaceWith(clone_2); break_cycle = true; } else{ clone_1 = jQuery('#modal_welcome_c'); clone_2 = jQuery('#slogan_id_c'); current_lang = clone_1.attr('lang_id'); } if(select_index!=current_lang){ clone_1.animate({opacity:0},801); clone_2.animate({opacity:0},801,function(){ clone_1.text(welcome_texts[select_index]); clone_2.text(slogan_texts[select_index]); clone_1.animate({opacity:1},501); clone_2.animate({opacity:1},501); }); } else{ clone_1.css('opacity','1'); clone_2.css('opacity','1'); clone_1.text(welcome_texts[select_index]); clone_2.text(slogan_texts[select_index]); } clone_1.attr('lang_id',select_index); clone_2.attr('lang_id',select_index); }); }); jQuery('#welcome_modal').hammer().bind(&quot;swipeleft&quot;, function(e){ if(jQuery(&quot;.active&quot;, e.target).index()==1){ jQuery('#welcome_modal').modal('hide'); } else{ if(current_language!=-1){ jQuery('#first_slider').carousel('next'); } else{ openLanguageModal(); } } }); jQuery('#welcome_modal').hammer().bind(&quot;swiperight&quot;, function(){ if(current_language!=-1){ jQuery('#first_slider').carousel('prev'); } else{ openLanguageModal(); } }); jQuery('.switch_page_icon').on('click',function(){ if(current_language!=-1){ jQuery('#first_slider').carousel('next'); } else{ openLanguageModal(); } }) jQuery('.c-back-button').on('click',function(){ jQuery('#first_slider').carousel('prev'); }) jQuery('#first_slider').on('slide.bs.carousel', function (e) { if(jQuery(&quot;.active&quot;, e.target).index()==0){ jQuery('.c-back-button').fadeIn('slow'); jQuery('.infotext_head').text(instruction_heads[current_language]); jQuery(&quot;.text-left-span&quot;).text(instruction_texts[current_language]); jQuery(&quot;#go_span&quot;).text(go_texts[current_language]); } else{ jQuery('.c-back-button').fadeOut('fast'); } }) jQuery('.startbutton').on('click',function(){ jQuery('#welcome_modal').modal('hide'); }) jQuery('#welcome_modal').on('hidden.bs.modal', function () { //jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}); startMainTool(); }) } /** * [handleWordSpanClick description] * */ function handleWordSpanClick(){ if(allow_select) { if(!jQuery('#concepts_modal').hasClass('fade')){ jQuery('#concepts_modal').css('opacity',&quot;1&quot;); jQuery('#concepts_modal').addClass('fade'); } jQuery('#concepts_modal').modal({ keyboard: false }); if(jQuery('#custom_modal_backdrop').length&lt;1)showCustomModalBackdrop(); } } /** * [handleLocationSpanClick description] * */ function handleLocationSpanClick(){ if(allow_select){ if(!jQuery('#locations_modal').hasClass('fade')){ jQuery('#locations_modal').css('opacity',&quot;1&quot;); jQuery('#locations_modal').addClass('fade'); } jQuery('#locations_modal').modal({ keyboard: false }); if(jQuery('#custom_modal_backdrop').length&lt;1)showCustomModalBackdrop(); } } /** * [menu_is_up description] * */ function menu_is_up() { startTutorial(); jQuery('.highscoreicon').on('click',function(){ buildHighScoreSelect(); }) } /** * Creates and returns a indexed array of all concepts in the user's language. * @param {Array} concepts_cur_lang Array with all concepts in the language of the user. * @return {Object} Indexed Array containing concept id and the concept in the current language. */ function createConceptIndexList(concepts_cur_lang){ var result = {}; for(var i=0;i&lt;concepts_cur_lang.length;i++){ result[parseInt(concepts_cur_lang[i].id)] = {index:i,name:concepts_cur_lang[i].name}; } return result; } /** * Builds an indexed array containing the number of entries for concepts that the user has entered and the concept's id. * @param {Object} submitedAnswersIndexed indexed array containing all submited entries by the current user. * @return {Object} contains concept id and number of entries for the associated concept. */ function createAnswersToEntryNumbers(submitedAnswersIndexed){ var result = {}; for(var key in submitedAnswersIndexed) { var entry = result[parseInt(submitedAnswersIndexed[key].concept_id)]; if(entry==null) result[parseInt(submitedAnswersIndexed[key].concept_id)] = 1; else result[parseInt(submitedAnswersIndexed[key].concept_id)] +=1; } // for(var i=0;i&lt;submitedAnswers.length;i++){ // var entry = result[parseInt(submitedAnswers[i].concept_id)]; // if(entry==null) result[parseInt(submitedAnswers[i].concept_id)] = 1; // else result[parseInt(submitedAnswers[i].concept_id)] +=1; // } return result; } /** * Initializes the Popover Tutorials. * */ function startTutorial(){ tutorial_running = true; stage = 1; jQuery('#location_span').popover('show'); jQuery('.pop_location_span').parent().on('click',function(){ handleLocationSpanClick(); }).addClass('c_hover'); } /** * Opens Language Modal for the user to choose prefered language. * */ function openLanguageModal(){ // jQuery('.message_modal_content').text(&quot;Bitte wählen Sie eine Sprache aus!&quot;); jQuery('#language_modal').modal({ keyboard: true }); } /** * Builds Arrays containg the data for each row that will be displayed in the data tables. * @param {Array} in_data Can be Concepts or Locations Arrays. * @param {String} origin concept or location * @return {Array} Contains the html elements with the data for the data tables. */ function getTableData(in_data,origin){ var data = []; for ( var i=0 ; i&lt;in_data.length; i++ ) { var res = {column1:{}}; var name = in_data[i].name; var filtered_name = replaceSpecialChars(name); if(filtered_name!=name)filtered_name+=&quot; &quot;+name; else filtered_name = name; if(origin=='concept' &amp;&amp; i&lt;important_concepts_count)res.column1.html='&lt;div title=&quot;'+name+'&quot; class=&quot;dataparent&quot;&gt;&lt;span class=&quot;dataspan&quot;&gt;&lt;i title=&quot;'+important_concepts_texts[current_language]+'&quot; class=&quot;fa fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'+in_data[i].name+'&lt;/span&gt;&lt;/div&gt;'; else if(origin=='concept') res.column1.html='&lt;div title=&quot;'+name+'&quot; class=&quot;dataparent&quot;&gt;&lt;span class=&quot;dataspan&quot;&gt;'+name+'&lt;/span&gt;&lt;/div&gt;'; else res.column1.html='&lt;div class=&quot;dataparent&quot;&gt;&lt;span title=&quot;'+name+'&quot; class=&quot;dataspan&quot;&gt;'+name+'&lt;/span&gt;&lt;/div&gt;'; res.column1.filtered_name = filtered_name; data.push(res); } return data; } /** * Adds event listeners to all modals. */ function addModalListeners(){ jQuery('#locations_modal .customclose').on('click',function(){ jQuery('#locations_modal').modal('hide'); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) }) jQuery('#concepts_modal .customclose').on('click',function(){ jQuery('#concepts_modal').modal('hide'); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) }) jQuery('#image_modal .customclose').on('click',function(){ jQuery('#image_modal').modal('hide'); }) jQuery('#message_modal .customclose').on('click',function(){ jQuery('#message_modal').modal('hide'); }) jQuery('#language_modal .customclose').on('click',function(){ jQuery('#language_modal').modal('hide'); }) jQuery('#register_modal .customclose').on('click',function(){ jQuery('#register_modal').modal('hide'); console.log(&quot;custom close&quot;); }) jQuery('#location_list_modal .customclose').on('click',function(){ jQuery('#location_list_modal').modal('hide'); }) jQuery('#input_modal .customclose').on('click',function(){ jQuery('#input_modal').modal('hide'); }) jQuery('#editInput_modal .customclose').on('click',function(){ jQuery('#editInput_modal').modal('hide'); }) jQuery('#image_modal').hammer().bind(&quot;swipeleft&quot;, function(e){ jQuery('#image_slider').carousel('next'); }); jQuery('#image_modal').hammer().bind(&quot;swiperight&quot;, function(e){ jQuery('#image_slider').carousel('prev'); }); jQuery('#highscore_select_modal .customclose').on('click',function(){ jQuery('#highscore_select_modal').modal('hide'); }) jQuery('#toplistmodal .customclose').on('click',function(){ jQuery('#toplistmodal').modal('hide'); }) jQuery('#why_register_modal .customclose').on('click',function(){ prevent_backdrop=false; jQuery('#why_register_modal').modal('hide'); }) jQuery(&quot;#icon_login&quot;).on('click',function(){ jQuery('#register_modal').modal(); }) /* jQuery('#open_login_modal').on('click',function(){ jQuery('register_modal').modal(); }) */ bindShowListeners_Modal(); } /** * [bindShowListeners_Modal description] * */ function bindShowListeners_Modal(){ jQuery('#locations_modal').on('shown.bs.modal', function (e) { if(modals_initialized){ datatable_locations.scroller.measure(); setTimeout(function() { datatable_locations.scroller.measure(); }, 10); displayTooltips(false); if(process_restarted){ closeAllInfoWindows();process_restarted=false;} setTimeout(function(){ // jQuery('#locations_modal').find('input').focus(); document.getElementById(&quot;focusinput&quot;).focus(); },0); if(saved_location_index!=-1){ datatable_locations.row(saved_location_index).scrollTo(); } } else{ //extecuted once in initphase datatable_locations = createListModal(jQuery('#locations_modal'),location_data,&quot;location&quot;); jQuery('[data-toggle=&quot;tooltip&quot;]').tooltip(); //bugfix for scrollerplugin (resize not working properly) var modal = jQuery(this); var oldheight = modal.find('.dataTables_scroll').height(); modal.find('input').on('input',function (){ var height = modal.find('.dataTables_scroll').height() if(oldheight!=height) { datatable_locations.scroller.measure();oldheight=height; } }) } }) jQuery('#concepts_modal').on('shown.bs.modal', function (e) { if(modals_initialized){ datatable_concepts.scroller.measure(); setTimeout(function() { datatable_concepts.scroller.measure(); }, 10); displayTooltips(false); if(process_restarted){closeAllInfoWindows();process_restarted=false;} do_image_modal = false; if(current_concept_index!=-1){ datatable_concepts.row(current_concept_index).scrollTo(); } } else{ datatable_concepts = createListModal(jQuery('#concepts_modal'),concept_data,&quot;concept&quot;); //bugfix for scrollerplugin (resize not working properly) var modal = jQuery(this); var oldheight = modal.find('.dataTables_scroll').height(); modal.find('input').on('input',function (){ var height = modal.find('.dataTables_scroll').height() if(oldheight!=height) { datatable_concepts.scroller.measure();oldheight=height; } }) } }) jQuery('#image_modal').on('shown.bs.modal', function (e) { setTimeout(function() { jQuery('#image_modal').find('#image_slider').carousel({ interval: 3500 }) setDynamicContent('image'); }, 10); }) jQuery('#locations_modal').on('hidden.bs.modal', function () { setTimeout(function() {displayTooltips(true);}, 200); if(tutorial_running)showPopUp(); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) }) jQuery('#concepts_modal').on('hidden.bs.modal', function () { if(do_image_modal)jQuery('#image_modal').modal({}); if(!prevent_backdrop){ setTimeout(function() {displayTooltips(true);}, 200); if(tutorial_running)showPopUp(); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) } }) jQuery('#message_modal').on('shown.bs.modal', function (e) { jQuery('#userAuesserungInput').focus(); displayTooltips(false); }) jQuery('#message_modal').on('hidden.bs.modal', function (e) { jQuery('#userAuesserungInput').focus(); displayTooltips(true); }) jQuery('#register_modal').on('shown.bs.modal', function (e) { prevent_backdrop=false; jQuery(this).find('.custom-modal-footer button').on('click',function(){ jQuery('#register_modal').find('.custom-modal-footer button').removeClass('active_tab'); jQuery(this).addClass('active_tab'); }) console.log(&quot;Register Modal shown&quot;); }) jQuery('#register_modal').on('show.bs.modal', function (e) { if(!prevent_backdrop){ displayTooltips(false); showCustomModalBackdrop(); } console.log(&quot;Register Modal show&quot;); }) jQuery('#register_modal').on('hidden.bs.modal', function (e) { displayTooltips(true); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) console.log(&quot;Register Modal Hidden&quot;); }) jQuery('#input_modal').on('shown.bs.modal', function (e) { if(!jQuery('#location_list_modal').hasClass('in'))displayTooltips(false); }) jQuery('#input_modal').on('show.bs.modal', function (e) { jQuery('#custom_modal_backdrop').css('z-index','10000'); }) jQuery('#input_modal').on('hidden.bs.modal', function (e) { if(!jQuery('#location_list_modal').hasClass('in')){displayTooltips(true);} jQuery('#custom_modal_backdrop').css('z-index','1049'); }) jQuery('#welcomeback_modal').on('shown.bs.modal', function (e) { setTimeout(function() { startMainTool(); }, 500); }) jQuery('#welcome_modal').on('shown.bs.modal', function (e) { jQuery('#custom_backdrop').fadeOut('slow',function(){jQuery(this).remove();}); }) jQuery('#location_list_modal').on('show.bs.modal', function (e) { current_location_list_table = createLocationListTable(current_location_list_table_data); do_image_modal = false; }) jQuery('#location_list_modal').on('shown.bs.modal', function (e) { displayTooltips(false); current_location_list_table.scroller.measure(); current_location_list_table.columns.adjust(); }) jQuery('#location_list_modal').on('hidden.bs.modal', function () { setTimeout(function() {displayTooltips(true);}, 200); if(tutorial_running)showPopUp(); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) if(do_image_modal)jQuery('#image_modal').modal({}); }) jQuery('#toplistmodal').on('show.bs.modal', function (e) { current_top_list_table = createTopListTable(current_highscoredata); }) jQuery('#toplistmodal').on('shown.bs.modal', function (e) { prevent_backdrop = false; current_top_list_table.columns.adjust(); }) jQuery('#toplistmodal').on('hidden.bs.modal', function (e) { jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) displayTooltips(true); }) jQuery('#highscore_select_modal').on('hidden.bs.modal', function (e) { if(!prevent_backdrop){ jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) displayTooltips(true); } }) jQuery('#highscore_select_modal').on('show.bs.modal', function (e) { displayTooltips(false); }) jQuery('#why_register_modal').on('show.bs.modal', function (e) { if(!prevent_backdrop){ showCustomModalBackdrop(); displayTooltips(false); } }) jQuery('#why_register_modal').on('hidden.bs.modal', function (e) { if(!prevent_backdrop){ displayTooltips(true); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}) } }) jQuery('#why_register_modal').on('shown.bs.modal', function (e) { if(prevent_backdrop)prevent_backdrop=false; }) } function buildTable(list){ console.log(list.length); var result = jQuery('&lt;tbody&gt;'); for(var i=0;i&lt;list.length;i++){ var tr = jQuery('&lt;tr&gt;&lt;/tr&gt;'); tr.attr('ref_id',list[i]['id']); tr.append(jQuery('&lt;td&gt;'+list[i]['name']+'&lt;/td&gt;')); result.append(tr); } return result; } function createListModal(modal,data,origin) { var id; var scrollY; if(origin==&quot;concept&quot;){ id = &quot;#concept_modal_table&quot;; scrollY= &quot;76vh&quot; } else { id = &quot;#location_modal_table&quot;; scrollY= &quot;80vh&quot; } var table = modal.find(id).DataTable( { data:data, columns: [ { data: { _: &quot;column1.html&quot;, filter: &quot;column1.filtered_name&quot; } }, ], deferRender: false, //otherwise .node() won't always work scrollY: scrollY, scrollX: false, scrollCollapse: true, info:false, ordering : false, scroller: { displayBuffer: 2, }, fnInitComplete: function(settings) { var input = modal.find('input'); if(origin=='location'){input.attr('autofocus',&quot;&quot;);input.attr('id','focusinput');} //id for js call in bind show listeners input.attr('autocomplete',&quot;off&quot;); var buttonparent; if(!modals_initialized &amp;&amp; origin==&quot;concept&quot;) { buttonparent = jQuery('&lt;div class=&quot;list_modal_button_parent&quot;&gt;&lt;/div&gt;'); jQuery('#concept_modal_table_filter').after(buttonparent); var random_button = jQuery('&lt;div class=&quot;list_modal_button_in_search&quot;&gt;&lt;i class=&quot;fa fa-random&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+random_texts[current_language]+'&lt;/div&gt;'); buttonparent.append(random_button); random_button.on('click',function(){ if(!prevent_randomclick) { do_image_modal = false; prevent_randomclick = true; if(jQuery('#concepts_modal').find('input').val()!=&quot;&quot;)datatable_concepts.search('').columns().search('').draw(); var rnd_idx = getRandomUnAnsweredConceptIndex(); datatable_concepts.row(rnd_idx).scrollTo(); deSelectTableEntry(current_concept_index); selectTableEntry(rnd_idx); current_concept_index = rnd_idx; var name = concepts_cur_lang[rnd_idx].name; concept_selected = true; var id= concepts_cur_lang[rnd_idx].id; jQuery('#word_span').text(name); jQuery('#word_span').attr(&quot;data-id_concept&quot;,id); jQuery('#word_span').attr(&quot;data-id_concept_index&quot;,rnd_idx); setDynamicContent('list'); if(!jQuery('#why_register_modal').hasClass('in'))checkImageModal(id,name); setTimeout(function() {prevent_randomclick=false}, 500); } }) var suggest_button = jQuery('&lt;div class=&quot;list_modal_button_in_search&quot;&gt;&lt;i class=&quot;fa fa-plus&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+suggest_texts[current_language]+'&lt;/div&gt;'); buttonparent.append(suggest_button); if(!userLoggedIn)suggest_button.addClass('disabled_feature'); suggest_button.on('click',function(){ if(!userLoggedIn){ prevent_backdrop=true; jQuery('#concepts_modal').modal('hide'); openWhyRegisterModal(); } else{ jQuery('.input_modal_content').empty(); var suggest_headline = jQuery('&lt;div class=&quot;suggest_headline&quot;&gt;'+suggest_texts[current_language]+':&lt;/div&gt;'); var suggest_field = jQuery('&lt;input class=&quot;suggest_field&quot;&gt;&lt;/input&gt;'); var suggest_button_submit = jQuery('&lt;div class=&quot;suggest_button_submit suggest_btn&quot;&gt;'+submit_texts[current_language]+'&lt;/div&gt;'); var feedback_div = jQuery('&lt;div class=&quot;feedback_suggest&quot;&gt;'+feedback_texts[current_language]+'&lt;/div&gt;'); jQuery('.input_modal_content').append(suggest_headline).append(suggest_field).append(suggest_button_submit); jQuery('#input_modal').modal(); suggest_button_submit.off().on('click',function(){ if(suggest_field.val()==&quot;&quot;){ markInputRed(suggest_field); } else{ sendSuggestEmail(suggest_field.val(),function(){ suggest_button_submit.fadeOut('fast',function(){ jQuery('.input_modal_content').append(feedback_div); feedback_div.fadeIn('fast'); setTimeout(function() { jQuery('#input_modal').modal('hide'); jQuery('.input_modal_content').empty(); }, 1500); }) }) } }) } }) } modal.find('tbody').on('click', 'tr', function () { var index = table.row(this).index() if(origin==&quot;concept&quot;){ var name = concepts_cur_lang[index].name; concept_selected = true; var id= concepts_cur_lang[index].id; if(current_concept_index!=-1) deSelectTableEntry(current_concept_index); selectTableEntry(index); current_concept_index = index; jQuery('#image_modal').modal('hide'); jQuery('#word_span').text(name); jQuery('#word_span').attr(&quot;data-id_concept&quot;,id); jQuery('#word_span').attr(&quot;data-id_concept_index&quot;,index); setDynamicContent('list'); // for offset since hight of left menu could change checkImageModal(id,name); jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}); /*END*/ } else{ location_selected = true; var name = locations[index].name; var id= locations[index].id; if(saved_location_index!=index){ var row = table.row(index).node(); jQuery(row).addClass('green_row'); var icon = jQuery('&lt;i class=&quot;fa fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'); jQuery(row).find('.dataspan').prepend(icon); } //for unsetting green on pervious selection if(saved_location_index!=-1 &amp;&amp; saved_location_index!=index){ var row = table.row(saved_location_index).node(); jQuery(row).removeClass('green_row'); jQuery(row).find('.fa-check').remove(); } saved_location_index = index; saved_location_name = name; jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()}); jQuery('#location_span').text(name); jQuery('#location_span').attr(&quot;data-id_location&quot;,id); setDynamicContent('list'); // for offset since hight of left menu could change /*Show Gemeinde Grenzen*/ jQuery('#image_modal').modal('hide'); var g_location = name; var g_location_id = id; var index = contains.call(existingLocations,g_location_id); //console.log(existingLocations); showPolygon(g_location,g_location_id,index); /*END*/ } setTimeout(function() {modal.modal('hide');}, 220); //delay to show select effect }) if(!modals_initialized){ setTimeout(function() {modal.modal('hide');}, 1); //for closing modal on init if(origin!='concept')locations_modal_modals_initialized =true; else concepts_modal_initialized = true; if(locations_modal_modals_initialized&amp;&amp;concepts_modal_initialized){ modals_initialized=true; /*setTimeout(function() { jQuery('#custom_backdrop').fadeOut('slow',function(){ if(language_is_set)jQuery('#welcomeback_modal').modal('hide'); }); }, 100);*/ if(language_is_set)jQuery('#welcomeback_modal').modal('hide'); } } } } ); return table; } /** * Build Image Slider * @param {Array} _images [description] * @param {Array} _caption [description] * @return {String} Div-element, containg images and their captions. */ function buildCarousel(_images,_caption){ jQuery('#image_modal').find('#image_slider').remove(); var result = jQuery('&lt;div id=&quot;image_slider&quot; class=&quot;carousel slide&quot; data-ride=&quot;carousel&quot;&gt;'); if(_images.length&gt;1){ var ol = jQuery('&lt;ol class=&quot;carousel-indicators findicators&quot;&gt;&lt;/ol&gt;'); for(var i=0;i&lt;_images.length;i++){ var li = jQuery('&lt;li data-target=&quot;#image_slider&quot; data-slide-to=&quot;'+i+'&quot;&gt;&lt;/li&gt;') if(i==0)li.addClass('active'); ol.append(li); } result.append(ol); } var inner = jQuery('&lt;div class=&quot;carousel-inner&quot; role=&quot;listbox&quot;&gt;'); for(var i=0;i&lt;_images.length;i++){ var item = jQuery('&lt;div class=&quot;carousel-item&quot;&gt;'); if(i==0)item.addClass('active'); var body = jQuery('&lt;div class =&quot;i_fake_body&quot;&gt;&lt;/div&gt;'); var image_overlay = jQuery('&lt;div class =&quot;i_overlay&quot;&gt;&lt;/div&gt;'); var caption = jQuery('&lt;div class=&quot;carousel-caption first-info&quot;&gt;'+_caption+'&lt;/div&gt;'); body.append(image_overlay); item.append(caption); item.append(body); inner.append(item); body.css({'background':'url('+_images[i]+')', 'background-repeat':'no-repeat', 'background-size':&quot;cover&quot; }); } result.append(inner); if(_images.length&gt;1)result.append(jQuery('&lt;a class=&quot;left carousel-control&quot; href=&quot;#image_slider&quot; role=&quot;button&quot; data-slide=&quot;prev&quot;&gt;&lt;span class=&quot;icon-prev&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sr-only&quot;&gt;Previous&lt;/span&gt;&lt;/a&gt;&lt;a class=&quot;right carousel-control&quot; href=&quot;#image_slider&quot; role=&quot;button&quot; data-slide=&quot;next&quot;&gt;&lt;span class=&quot;icon-next&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sr-only&quot;&gt;Next&lt;/span&gt;&lt;/a&gt;')); return result; } /** * [calculateCenter description] * */ function calculateCenter() { center = map.getCenter(); } function displayCoordinates(pnt) { var lat = pnt.lat(); lat = lat.toFixed(4); var lng = pnt.lng(); lng = lng.toFixed(4); console.log(&quot;Latitude: &quot; + lat + &quot; Longitude: &quot; + lng); } /** * Change the language displayed. Used for Welcome Modal. * @param {String} element [description] * @param {Array} textlist [description] * @param {Int} i [description] * @param {Function} callback [description] * */ function cycleText(element,textlist,i,callback){ if(!break_cycle){ i++; setTimeout(function() { element.attr('lang_id',i); element.animate({opacity:0},800,function(){ element.text(textlist[i]); element.animate({opacity:1},500,function(){ requestAnimationFrame(function(){cycleText(element,textlist,i,callback)}); }); }); if(i==textlist.length)i=0; }, 1300); if(typeof callback == &quot;function&quot;) callback(i); } } /** * Adjusts Visial Elements, solves problem with wordpress visialization. * */ function moveElements(){ if(userLoggedIn){ var loginout = jQuery(document).find('#wp-logout').detach(); loginout.addClass(&quot;btn btn-primary btn-lg&quot;); jQuery('#log_in_div').append(loginout); jQuery('.lwa').remove(); }else{ /* var loginout_notlogged = jQuery(document).find('.lwa-links-modal').detach(); loginout_notlogged.addClass(&quot;btn btn-primary btn-lg&quot;); jQuery('#log_in_div').append(loginout_notlogged); */ } } /** * [initConceptModal description] */ function initConceptModal(){ jQuery('#concepts_modal').css('opacity',&quot;0&quot;); jQuery('#concepts_modal').modal({}); } /** * [initLocationsModal description] */ function initLocationsModal(){ jQuery('#locations_modal').css('opacity',&quot;0&quot;); jQuery('#locations_modal').modal({}); } /** * [showCustomBackdrop description] * */ function showCustomBackdrop(){ var custom_backdrop = jQuery('&lt;div id=&quot;custom_backdrop&quot;&gt;&lt;i class=&quot;fa fa-circle-o-notch fa-spin fa-3x fa-fw&quot;&quot;&gt;&lt;/i&gt;&lt;/div&gt;'); jQuery('body').append(custom_backdrop); jQuery('#custom_backdrop').fadeIn(); } /** * [showCustomModalBackdrop description] * */ function showCustomModalBackdrop(){ jQuery('#custom_modal_backdrop').remove(); var custom_backdrop = jQuery('&lt;div id=&quot;custom_modal_backdrop&quot;&gt;&lt;/div&gt;'); jQuery('body').append(custom_backdrop); jQuery('#custom_modal_backdrop').fadeIn('fast'); } function addToolTips(elements){ for(var i=0;i&lt;elements.length;i++){ addToolTip(elements[i].name,elements[i].array); } } function addToolTip(element,title_array){ var class_string = element.replace(&quot;#&quot;, &quot;&quot;); class_string = &quot;pop_&quot;+class_string; var offsetstring = &quot;0 0&quot;; if(class_string == &quot;pop_submitanswer&quot;)offsetstring=&quot;5 9&quot;; jQuery(element).popover({ trigger:&quot;manual&quot;, placement:&quot;top&quot;, container:&quot;body&quot;, content:'&lt;div class=&quot;'+class_string+' custom_popover_content&quot;&gt;'+title_array[current_language]+'&lt;/div&gt;', html:true, animation:true, offset:offsetstring }); } function addLoginToolTip(){ jQuery('#icon_login').popover({ trigger:&quot;manual&quot;, placement:&quot;left&quot;, container:&quot;body&quot;, content:'&lt;div class=&quot;login_popover custom_popover_content&quot;&gt;'+register_texts[current_language]+'&lt;/div&gt;', html:true, animation:true, offset:&quot;0 0&quot; }); jQuery('#icon_login').popover('hide'); } function showLoginPopUp(){ jQuery('#icon_login').popover('show'); jQuery('.login_popover').parent().on('click',function(){ jQuery('#register_modal').modal(); //{} console.log(&quot;Login Popover&quot;); }).addClass('c_hover'); } function showPopUp(){ if(tutorial_running &amp;&amp; location_selected &amp;&amp;!concept_selected){ jQuery('#location_span').popover('hide'); jQuery('#word_span').popover('show'); stage=2; jQuery('.pop_word_span').parent().on('click',function(){ handleWordSpanClick(); }).addClass('c_hover'); } else if(tutorial_running &amp;&amp; !location_selected &amp;&amp;!concept_selected){ stage=1; jQuery('#location_span').popover('show'); jQuery('.pop_location_span').parent().on('click',function(){ handleLocationSpanClick(); }).addClass('c_hover'); } else if(tutorial_running &amp;&amp; !location_selected &amp;&amp;concept_selected) { jQuery('#word_span').popover('hide');jQuery('#location_span').popover('show'); stage=1; jQuery('.pop_location_span').parent().on('click',function(){ handleLocationSpanClick(); }).addClass('c_hover'); } else if(tutorial_running &amp;&amp; location_selected &amp;concept_selected &amp;&amp;!word_entered) { jQuery('#word_span').popover('hide');jQuery('#location_span').popover('hide'); jQuery('#user_input').popover('show'); jQuery('#user_input').val(&quot;&quot;); stage=3; jQuery('.pop_user_input').parent().parent().css('top',&quot;5px&quot;); jQuery('.pop_user_input').parent().on('click',function(){ jQuery('#user_input').focus(); if(process_restarted){closeAllInfoWindows();process_restarted=false;} }).addClass('c_hover'); } if(word_entered &amp;&amp;stage&lt;4 &amp;&amp;location_selected &amp;&amp;concept_selected){ if(stage!=4){ jQuery('#user_input').popover('hide'); jQuery('#submitanswer').popover('show'); jQuery('.pop_submitanswer').parent().on('click',function(){ if(!submit_button_clicked){ saveWord(); submit_button_clicked = true; setTimeout(function(){ submit_button_clicked = false; console.log('submit button: After saveword() ' + submit_button_clicked);}, 1000); } }).addClass('c_hover'); } stage = 4; } if(stage == 6){ jQuery('#word_span').popover('hide'); tutorial_running = false; } } function displayTooltips(show){ if(show)jQuery('.popover').css('opacity','1'); else jQuery('.popover').css('opacity','0'); } /*jQuery(function () { jQuery('#register_modal').modal('toggle'); });*/ /*jQuery('#register_modal').on('shown.bs.modal', function () { jQuery('#lwa_user_login').focus() }) jQuery('#login_slider').bind('slid.bs.carousel', function (e) { console.log('after slide'); jQuery('#login_slider').data('ride', &quot;&quot;); jQuery('#login_slider').carousel('pause'); });*/ function showSlide(x){ switch(x){ case &quot;login&quot;: jQuery('.active').removeClass('active'); jQuery('#login_slide').addClass('active'); break; case &quot;remember&quot;: jQuery('.active').removeClass('active'); jQuery('#remember_slide').addClass('active'); break; case &quot;register&quot;: jQuery('.active').removeClass('active'); jQuery('#register_slide').addClass('active'); break; } } jQuery(&quot;.btn&quot;).mouseup(function(){ jQuery(this).blur(); }) /* jQuery(function () { jQuery('[data-toggle=&quot;popover&quot;]').popover() jQuery('#login_div').popover('show'); }) */ // jQuery('#icon_login').hover( function(){ // jQuery(this).removeClass('fa-user-circle-o'); // jQuery(this).addClass('fa-user-circle'); // },function(){ // jQuery(this).removeClass('fa-user-circle'); // jQuery(this).addClass('fa-user-circle-o'); // }) var enableSubmit = function(ele) { jQuery(ele).removeAttr(&quot;disabled&quot;); jQuery(ele).attr('enable',true); console.log(&quot;enable&quot;); } /* jQuery('.fa-sign-out').on('mouseover', function(){ jQuery(this).css('fa-2x'); })*/ /** * When user changes his entry the data is then been processed and updated to the server. * @param {Int} id_auesserung [description] * @param {Int} id_concept [description] * @param {Int} location_id [description] * @param {String} concept [description] * @param {Int} row_to_update [description] * @return {String} [description] */ function editInputA(id_auesserung,id_concept,location_id,concept,row_to_update){ jQuery('.input_modal_content').html( returnChangeInput() ); jQuery('#input_modal').modal({ backdrop: 'static', keyboard: false }); jQuery('#input_modal').one('shown.bs.modal', function (e) { jQuery(this).find('button').on('click',function(){ updateInput(concept,id_auesserung,id_concept,location_id,row_to_update); }); }) } /** * @deprecated */ function editInput(location,concept,input_word){ jQuery('.message_modal_content').text(&quot;Sie haben diese Auesserungen schon gespeichert!&quot;); jQuery('.message_modal_content').html(returnChangeInput(location,concept,input_word)); jQuery('#message_modal').modal({ backdrop: 'static', keyboard: false }); } /*When location is choosen show polygon will check if this location's polygon exists else it will get it from the database*/ /** * After Choosing a locations from the location data tables. Get the location's polygon and display it. * @param {String} g_location [description] * @param {Int} g_location_id [description] * @param {Int} index [description] * */ function showPolygon(g_location,g_location_id,index){ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getPolygonGemeinde', location_id : g_location_id, searchedGemeinde : g_location, }, success : function( response ) { existingLocations.push(JSON.parse(response).location_id); addGeometry(JSON.parse(response).polygonCoordinates,JSON.parse(response)); //console.log('POlygon'); if(map.getZoom()&gt;6){ map.setZoom(6); //console.log(&quot;zoomed&quot;); } var lat_g = parseGeoData(JSON.parse(response).centerCoordinates).get().lat(); var lng_g = parseGeoData(JSON.parse(response).centerCoordinates).get().lng(); centerCoordinates_locations.push({'id':JSON.parse(response).location_id,'lat':lat_g,'lng':lng_g}); map.panTo({lat: lat_g, lng: lng_g}); setTimeout(function() { smoothZoom(map, 11, map.getZoom()); }, 200); if(stage==5){ stage = 6; setTimeout(function() { jQuery('#word_span').popover('show'); displayTooltips(true); }, 2000); } } });//ajax end } /*Filter Auesserungen Markers for the choosen Concept*/ /** * @deprecated */ function filterMarkers(id){ for(var i = 0; i &lt; markers.length; i++){ if(markers[i].concept_id.localeCompare(id) == 0){ console.log('this concept'); if(markers[i].type.localeCompare('userInput') != 0){ markers[i].marker.setIcon(markershape); } if(markers[i].userMarker){ markers[i].marker.setIcon(markershapeChoosen); } }else{ if(markers[i].type.localeCompare('userInput') != 0){ markers[i].marker.setIcon(markershapeFiltered); } if(markers[i].userMarker){ markers[i].marker.setIcon(markershapeChoosen); } } } } /** * Replace special characters(from different languages) to siplify the search. * Used to simplify searching for concept or location that have spacial characters in different languages. * @param {String} _in [description] * @return {String} [description] */ function replaceSpecialChars(_in){ var res = _in.replace(/[äÄáÁàÀâÂãÃåÅæÆ]/g, 'a') .replace(/[çÇčČ]/g, 'c') .replace(/[éÉèÈêÊëË]/g, 'e') .replace(/[íÍìÌîÎïÏîĩĨĬĭ]/g, 'i') .replace(/[ñÑ]/g, 'n') .replace(/[öÖóÓòÒôÔœŒ]/g, 'o') .replace(/[ßšŠ]/g, 's') .replace(/[úÚùÙûÛ]/g, 'u') .replace(/[ýÝŷŶŸÿ]/g, 'n') .replace(/[áÁàÀâÂãÃåÅæÆ]/g, 'a') .replace(/[çÇ]/g, 'c') .replace(/[éÉèÈêÊëË]/g, 'e') .replace(/[íÍìÌîÎïÏîĩĨĬĭ]/g, 'i') .replace(/[ñÑ]/g, 'n') .replace(/[óÓòÒôÔœŒ]/g, 'o') .replace(/[ß]/g, 's') .replace(/[üÜúÚùÙûÛ]/g, 'u') .replace(/[ýÝŷŶŸÿ]/g, 'n') .replace(/[Žž]/g, 'z'); return res; } /** * Sets a random image as background for the different modals. * @param {Function} callback [description] * @param {Int} modal_id [description] */ function setRandomTitelImage(callback,modal_id){ var number = Math.floor(Math.random() * 7) + 1; var jpg = &quot;titel_&quot; +number.toString()+&quot;.jpg&quot;; var img_url = url.plugins_Url+'/assets/images/'+jpg; jQuery('&lt;img/&gt;').attr('src', img_url).load(function() { jQuery(this).remove(); jQuery(modal_id).find('.modal-body').css('background','url('+img_url+')'); jQuery(modal_id).find('.modal-body').css('background-repeat','no-repeat'); jQuery(modal_id).find('.modal-body').css('background-size','cover'); if(typeof callback == &quot;function&quot;){ callback(); } }); } /** * Open location's data table. * @param {Object} marker Location's marker. */ function openLocationListModal(marker){ if(jQuery('#custom_modal_backdrop').length&lt;1)showCustomModalBackdrop(); current_location_list_object = aeusserungen_by_locationindex[marker.location_id]; // find the right object from the array function rightOne(obj) { return obj.id == marker.location_id; } //the correct translation of the location var c_location_name = locations[locations.findIndex(rightOne)].name; current_location_list_object[Object.keys(current_location_list_object)[0]].ortsname=c_location_name; current_location_list_object[Object.keys(current_location_list_object)[0]].usergen= marker.user_marker; current_location_list_table_data = getLocationListTableData(current_location_list_object); jQuery('#location_list_table').DataTable().destroy(); jQuery('#location_list_modal').find('.location_header_parent').remove(); jQuery('#location_list_modal').modal(); } /** * Build locations data for the data table. * @param {Array} in_data [description] * @return {Array} [description] */ function getLocationListTableData(in_data){ var data = []; var i =0; for(var key in in_data) { var cur_data = in_data[key]; var user_data = false; var aeusserung_id = cur_data.id_aeusserung; if(submitedAnswers_indexed[aeusserung_id]!=null)user_data = true; var concept_name = cur_data.konzept; var author = cur_data.author; var word = cur_data.word; var concept_idx = concepts_index_by_id[cur_data.id_concept].index; var token = cur_data.tokenisiert; if(author.indexOf(&quot;anonymous&quot;) != -1) author=anonymous_texts[current_language]; data[i] = []; if(concept_idx&lt;important_concepts_count)data[i].push('&lt;div ae_id=&quot;'+aeusserung_id+'&quot; con_id=&quot;'+cur_data.id_concept+'&quot; user_data=&quot;'+user_data+'&quot; class=&quot;dataparent&quot; title=&quot;'+concept_name+'&quot; token=&quot;'+token+'&quot;&gt;&lt;span class=&quot;dataspan&quot;&gt;&lt;i title=&quot;'+important_concepts_texts[current_language]+'&quot; class=&quot;fa fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'+concept_name+'&lt;/span&gt;&lt;/div&gt;'); else data[i].push('&lt;div ae_id=&quot;'+aeusserung_id+'&quot; con_id=&quot;'+cur_data.id_concept+'&quot; user_data=&quot;'+user_data+'&quot; class=&quot;dataparent&quot; title=&quot;'+concept_name+'&quot; token=&quot;'+token+'&quot;&gt;&lt;span class=&quot;dataspan&quot;&gt;'+concept_name+'&lt;/span&gt;&lt;/div&gt;'); data[i].push('&lt;span class=&quot;c_answer_span dataspan&quot; title=&quot;'+word+'&quot;&gt;\\&quot;'+word+'\\&quot;&lt;/span&gt;'); data[i].push('&lt;span class=&quot;authorspan dataspan&quot; title=&quot;'+author+'&quot;&gt;('+author+')&lt;/span&gt;'); // data[i].push('&lt;div class=&quot;location_list_controls&quot;&gt;&lt;div class=&quot;change_button_in_list rowbutton&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+change_input[current_language]+'&lt;/div&gt;&lt;div class=&quot;delete_button_in_list rowbutton&quot;&gt;&lt;i class=&quot;fa fa-trash-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+delete_input[current_language]+'&lt;/div&gt;&lt;/div&gt;'); i++; } return data; } function createLocationListTable(table_data){ var searching = false; if(table_data.length&gt;10)searching=true; var table = jQuery('#location_list_modal').find('#location_list_table').DataTable( { data:table_data, deferRender: false, //otherwise .node() won't always work scrollY: &quot;75vh&quot;, scrollX: false, scrollCollapse: true, info:false, ordering : false, searching: searching, responsive:true, columns: [ { &quot;width&quot;: &quot;45%&quot; }, { &quot;width&quot;: &quot;30%&quot; }, { &quot;width&quot;: &quot;25%&quot; }, // { &quot;width&quot;: null} ], scroller: { displayBuffer: 15, }, fnInitComplete: function(settings) { var name = current_location_list_object[Object.keys(current_location_list_object)[0]].ortsname; var num = Object.keys(current_location_list_object).length; var usergen = current_location_list_object[Object.keys(current_location_list_object)[0]].usergen; var tokenisiert = current_location_list_object[Object.keys(current_location_list_object)[0]].tokenisiert; var head = jQuery('&lt;div class=&quot;location_header_parent&quot;&gt;&lt;div class=&quot;location_header_num&quot;&gt;'+num+'&lt;/div&gt;&lt;span class =&quot;location_header&quot;&gt;'+name+'&lt;/span&gt;&lt;/div&gt;'); if(usergen){ head.find('.location_header_num').addClass('user_generated_m'); } if(searching){ jQuery('#location_list_modal').find('#location_list_table_filter').prepend(head); head.css('display','inline-block'); jQuery('#location_list_modal').find('#location_list_table_filter').find('input').css('min-width','initial'); jQuery('#location_list_modal').find('#location_list_table_filter').find('label').css('width','initial').css('float','right').css('margin-top','-8px'); } else{ jQuery('#location_list_modal').find('.custom_header').after(head); } var animating = false; jQuery('#location_list_modal').find('tbody').off().on('click', 'tr', function () { if(!animating){ animating = true; if(jQuery(this).find('.dataparent').attr('user_data')==&quot;true&quot;){ /*display element depending if the Aeusserung is tokenisiert*/ var token = jQuery(this).find('.dataparent').attr('token'); if(token == &quot;0&quot;){ var element_to_animate = &quot;.location_list_controls&quot;; }else{ var element_to_animate = &quot;.tokenisiert&quot;; } if(jQuery(this).find(element_to_animate).css('right')==&quot;-170px&quot;){ jQuery(this).find(element_to_animate).show().animate({ right:[&quot;0&quot;, &quot;swing&quot;] }, 450, function() { jQuery(this).css('right','0px'); animating = false; }); } else{ jQuery(this).find(element_to_animate).animate({ right:[ &quot;-170&quot;, &quot;swing&quot;] }, 450, function() { jQuery(this).hide().css('right','-170px'); animating = false; }); } var clicked_index = table.row(this).index(); table.rows().eq(0).each( function (index) { var row = table.row(index); var jrow = jQuery(row.node()); if(clicked_index!=index &amp;&amp; (jrow.find(element_to_animate).css('right')==&quot;0px&quot;)){ jrow.find(element_to_animate).animate({ right:[ &quot;-170&quot;, &quot;swing&quot;] }, 450, function() { jrow.find(element_to_animate).hide().css('right','-170px'); }); } }); } else{ var id = parseInt(jQuery(this).find('.dataparent').attr('con_id')); var name = jQuery(this).find('.dataparent').attr('title'); setQ(name,id); jQuery('#location_list_modal').modal('hide'); } } }) }, createdRow: function (row, data, index ) { if(jQuery(row).find('.dataparent').attr('user_data')==&quot;false&quot;){ jQuery(row).addClass('other_user_row'); } else{ jQuery(row).addClass('this_user_row'); jQuery(row).append(jQuery('&lt;div class=&quot;location_list_controls&quot;&gt;&lt;div class=&quot;change_button_in_list rowbutton&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+change_input[current_language]+'&lt;/div&gt;&lt;div class=&quot;delete_button_in_list rowbutton&quot;&gt;&lt;i class=&quot;fa fa-trash-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+delete_input[current_language]+'&lt;/div&gt;&lt;/div&gt;')); /*tokeniriest*/ jQuery(row).append(jQuery('&lt;div class=&quot;tokenisiert&quot;&gt;&lt;i class=&quot;fa fa-check-square-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; ' + permanently_saved[current_language] + '&lt;/div&gt;')); // jQuery(row).append(jQuery('&lt;div class=&quot;tokenisiert&quot;&gt;&lt;div class=&quot;change_button_in_list rowbutton&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+'TEST'+'&lt;/div&gt;&lt;div class=&quot;delete_button_in_list rowbutton&quot;&gt;&lt;i class=&quot;fa fa-trash-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; '+'TEST'+'&lt;/div&gt;&lt;/div&gt;')); jQuery(row).find('.change_button_in_list').on('click',function(){ var aeusserung_id = jQuery(row).find('.dataparent').attr('ae_id'); var cur_obj = current_location_list_object[aeusserung_id]; var row_to_update = jQuery(row); editInputA(aeusserung_id,cur_obj.id_concept,cur_obj.id_geo,cur_obj.konzept,row_to_update); }) jQuery(row).find('.delete_button_in_list').on('click',function(){ table.row(jQuery(this).parents('tr')).remove().draw(); table.scroller.measure(); var aeusserung_id = jQuery(row).find('.dataparent').attr('ae_id'); var cur_obj = current_location_list_object[aeusserung_id]; deleteInput(aeusserung_id,cur_obj.ortsname,cur_obj.id_concept,cur_obj.id_geo); var remaining_num = Object.keys(aeusserungen_by_locationindex[cur_obj.id_geo]).length jQuery('#location_list_modal').find('.location_header_num').text(remaining_num); if(check_for_current_user_entries(cur_obj.id_geo) &lt;= 0){ jQuery('#location_list_modal').find('.location_header_num').removeClass('user_generated_m'); } if(remaining_num==0){ jQuery('#location_list_modal').modal('hide') } }) } } }) return table; } function checkImageModal(id,name){ var myimages=[]; myimages = images[id]; if(myimages.length&gt;0)do_image_modal=true; if(do_image_modal){ var c = buildCarousel(myimages,name); jQuery('#image_modal').find('.modal-body').append(c); } } function create_cookie(lang){ createCookie(&quot;language_crowder&quot;,lang); } /** * @deprecated */ function refresh_page(){ /*Choose another language*/ eraseCookie(&quot;language_crowder&quot;); console.log(document.cookie); location.reload(); } /** * [reMeasureDatatables description] * */ function reMeasureDatatables(){ if(current_location_list_table!=null){ current_location_list_table.scroller.measure(); } if(datatable_locations!=null){ datatable_locations.scroller.measure(); } if(datatable_concepts!=null){ datatable_concepts.scroller.measure(); } if(current_top_list_table!=null){ current_top_list_table.scroller.measure(); } } /** * Sets a timer, after which a login/register pop up will show up. * */ function startLoginTimer(){ if(!jQuery('.login_popover').parent().parent().hasClass('in') &amp;&amp; !jQuery('#register_modal').hasClass('in')){ setTimeout(function() { if(!jQuery('.modal').hasClass('in')){showLoginPopUp();} else{ jQuery('.modal').one('hidden.bs.modal', function () { showLoginPopUp(); }) } },3000); } setTimeout(function() { if(!jQuery('#register_modal').hasClass('in')){ hideAllOpenModals(); setTimeout(function() { openWhyRegisterModal(); }, 1000); } }, 90000); } /** * @deprecated */ function checkLoginPopUp(){ if(session_answer_count==3){ if(!jQuery('.login_popover').parent().parent().hasClass('in'))showLoginPopUp(); } } /** * [hideAllOpenModals description] */ function hideAllOpenModals(){ jQuery('.modal').each(function(){ if(jQuery(this).hasClass('in'))jQuery(this).modal('hide'); }) } function createUnansweredIndex(){ var allconceptindices = new Array(Object.keys(concepts_index_by_id).length); for(var i=0;i&lt;allconceptindices.length;i++){ allconceptindices[i] = i; } var return_object= {}; for(var key in submitedAnswers_indexed) { var submitted_index = submitedAnswers_indexed[key].concept_index; allconceptindices[submitted_index] = -1; } for(var i=0;i&lt;allconceptindices.length;i++){ if(allconceptindices[i]!=-1) return_object[allconceptindices[i]] = concepts_cur_lang[allconceptindices[i]]; } return return_object; } function getRandomUnAnsweredConceptIndex(){ var length = Object.keys(unanswered_concepts).length; var idx = Math.floor((Math.random() *length) + 0); return Object.keys(unanswered_concepts)[idx]; } function openHighScoreModal(array){ if(current_top_list_table!=null)current_top_list_table.destroy(); var table_data = []; var i =0; for(var key in array){ i++; var arr = array[key]; if(arr[3]){ table_data.push(['&lt;div class=&quot;highscorenumber&quot;&gt;'+i+'.&lt;/div&gt;','&lt;div class=&quot;concept_data&quot; id=&quot;' + arr[3] + '&quot;&gt;'+arr[0]+'&lt;/div&gt;',arr[1]]) }else if(arr[2]){ table_data.push(['&lt;div class=&quot;highscorenumber&quot;&gt;'+i+'.&lt;/div&gt;','&lt;div class=&quot;obj_data&quot; id=&quot;' + arr[2] + '&quot;&gt;'+arr[0]+'&lt;/div&gt;',arr[1]]) }else{ table_data.push(['&lt;div class=&quot;highscorenumber&quot;&gt;'+i+'.&lt;/div&gt;',arr[0],arr[1]]) } } current_highscoredata = table_data; jQuery('#highscore_select_modal').modal('hide'); jQuery('#toplistmodal').modal(); jQuery('#toplistmodal .obj_data').on('click',function(){ jQuery('#toplistmodal').modal('hide'); var g_location_id = jQuery(this).attr('id'); var g_location = jQuery(this).text(); showPolygon(g_location,g_location_id); //console.log(&quot;CLICKED!!!&quot;); }) jQuery('#toplistmodal .concept_data').on('click',function(){ var id = parseInt(jQuery(this).attr('id')); var name = jQuery(this).text(); setQ(name,id); jQuery('#toplistmodal').modal('hide'); setDynamicContent(); }) } function buildHighScoreSelect(){ setRandomTitelImage(function(){ showCustomModalBackdrop(); getHighScoresFromDB(function(){ jQuery('#best_user').one('click',function(){ openHighScoreModal(top_users); jQuery('.highscoreheadlinespan').text(active_user_texts[current_language]); prevent_backdrop = true; }).text(active_user_texts[current_language]) jQuery('#best_location').one('click',function(){ jQuery('.highscoreheadlinespan').text(active_location_texts[current_language]); openHighScoreModal(top_locations); prevent_backdrop = true; }).text(active_location_texts[current_language]) jQuery('#best_concept').one('click',function(){ openHighScoreModal(top_concepts); jQuery('.highscoreheadlinespan').text(active_concept_texts[current_language]); prevent_backdrop = true; }).text(active_concept_texts[current_language]) var icon = jQuery('&lt;i class=&quot;fa fa-pagelines leaf_icon_l&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'); var icon_r = jQuery('&lt;i class=&quot;fa fa-pagelines leaf_icon_r&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;'); jQuery('.select_score_list').prepend(icon); jQuery('.select_score_list').append(icon_r); jQuery('#highscore_select_modal').modal({}); }) //DB CALLBACK },&quot;#highscore_select_modal&quot;); //IMAGE CALLBACK } function createTopListTable(){ var table = jQuery('#toplistmodal').find('#top_list_table').DataTable( { data:current_highscoredata, deferRender: false, //otherwise .node() won't always work scrollY: &quot;75vh&quot;, scrollX: false, scrollCollapse: true, info:false, ordering : false, searching: false, responsive:true, columns: [ { &quot;width&quot;: &quot;20%&quot; }, { &quot;width&quot;: &quot;60%&quot; }, { &quot;width&quot;: &quot;20%&quot; }, ], scroller: { displayBuffer: 15, }, fnInitComplete: function(settings) {} }) return table; } function getHighScoresFromDB(callback){ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'getHighScores', lang : current_language, num: 10 }, success : function( response ) { var result = JSON.parse(response); top_concepts = result[&quot;top_concepts&quot;]; top_users = result[&quot;top_users&quot;]; top_locations = result[&quot;top_locations&quot;]; if(typeof callback == &quot;function&quot;) callback(); } }); } function openWhyRegisterModal(){ setRandomTitelImage(function(){ jQuery('.why_register_headline').html(register_head_texts[current_language]); jQuery('.why_register_body').html(register_body_texts[current_language]); jQuery('.reg_yes').text(register_yes_texts[current_language]); jQuery('.reg_no').text(register_no_texts[current_language]); jQuery('.reg_yes').off().on('click',function(){ prevent_backdrop=true; jQuery('#why_register_modal').modal('hide'); jQuery('#register_modal').modal(); }) jQuery('.reg_no').off().on('click',function(){ prevent_backdrop=false; jQuery('#why_register_modal').modal('hide'); }) jQuery('#why_register_modal').modal(); },&quot;#why_register_modal&quot;); //IMAGE CALLBACK } function sendSuggestEmail(entry, callback){ jQuery.ajax({ url: ajax_object.ajax_url, type: 'POST', data: { action : 'sendSuggestEmail', entry: entry, user : current_user, email : user_email, }, success : function( response ) { callback(); } }); } /*showPolygon(g_location,g_location_id,index)*/ /*jQuery('#toplistmodal .obj_id').on('click',function(){ jQuery('#image_modal').modal('hide'); var g_location_id = jQuery(this).attr('id'); var g_location_id = jQuery(this).val(); showPolygon(g_location,g_location_id,index); })*/ × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"geo.js.html":{"id":"geo.js.html","title":"Source: geo.js","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Source: geo.js /** * @module Geo_Parser */ //@file Parses Coordinate Objects to Google Maps Geo Objects /** * @param {string} string * * @return {google.maps.Data.Point} */ function parsePoint(string) { string = string.replace(&quot;POINT(&quot;, &quot;&quot;); string = string.replace(&quot;)&quot;, &quot;&quot;); var /** Array&lt;string&gt; */ result = string.split(' '); if(result.length != 2) return null; return new google.maps.Data.Point(new google.maps.LatLng(result[1] * 1, result[0] * 1)); } /** * @param {string} string * * @return {google.maps.Data.Geometry} */ function parseGeoData (string) { if(string.indexOf(&quot;MULTIPOLYGON&quot;) != -1){ return parseMultiPolygon(string); } else if(string.indexOf(&quot;POLYGON&quot;) != -1){ return parsePolygon(string); } else if(string.indexOf(&quot;MULTILINESTRING&quot;) != -1){ return parseMultiLineString(string); } else if(string.indexOf(&quot;LINESTRING&quot;) != -1){ return parseLineString(string); } else if(string.indexOf(&quot;POINT&quot;) != -1){ return parsePoint(string); } return null; } /** * @param {string} string * * @return {google.maps.Data.Polygon} */ function parsePolygon (string) { string = string.replace(&quot;POLYGON((&quot;,&quot;&quot;); string = string.replace(&quot;))&quot;,&quot;&quot;); return new google.maps.Data.Polygon(parsePolygonCoords(string)); } /** * @param {string} string * * @return {google.maps.Data.Polygon} */ function parseMultiPolygon (string) { string = string.replace(&quot;MULTIPOLYGON(((&quot;,&quot;&quot;); string = string.replace(&quot;)))&quot;,&quot;&quot;); /** * @type {Array&lt;string&gt;} */ var polygons = string.split(&quot;)),((&quot;); polygons[0].replace(&quot;((&quot;, &quot;&quot;); polygons[polygons.length-1].replace(&quot;))&quot;, &quot;&quot;); /** * @type {Array&lt;Array&lt;google.maps.LatLng&gt;&gt;} */ var resultList = new Array(); for (var i = 0; i &lt; polygons.length; i++) { resultList = resultList.concat(parsePolygonCoords(polygons[i])); } return new google.maps.Data.Polygon(resultList); } /** * @param {string} string * * @return {Array&lt;Array&lt;google.maps.LatLng&gt;&gt;} */ function parsePolygonCoords (string){ /** * @type {Array&lt;Array&lt;google.maps.LatLng&gt;&gt;} */ var coords = new Array(); /** * @type {Array&lt;string&gt;} */ var polygons = string.split(&quot;),(&quot;); for (var /** number */ i = 0; i &lt; polygons.length; i++) { coords[i] = new Array(); var values = polygons[i].split(&quot;,&quot;); for (var /** number */ j = 0; j &lt; values.length; j++) { var /** Array&lt;string&gt; */ coord = values[j].split(&quot; &quot;); coords[i].push(new google.maps.LatLng(coord[1] * 1, coord[0] * 1)); } } return coords; } /** * @param {string} string * * @return {Array&lt;google.maps.LatLng&gt;} */ function parseLineCoords (string){ /** * @type {Array&lt;google.maps.LatLng&gt;} */ var coords = new Array(); var values = string.split(&quot;,&quot;); for (var /** number */ j = 0; j &lt; values.length; j++) { var /** Array&lt;string&gt; */ coord = values[j].split(&quot; &quot;); coords.push(new google.maps.LatLng(coord[1] * 1, coord[0] * 1)); } return coords; } /** * @param {string} string * * @return {google.maps.Data.MultiLineString} */ function parseMultiLineString (string) { string = string.replace(&quot;MULTILINESTRING((&quot;,&quot;&quot;); string = string.replace(&quot;))&quot;,&quot;&quot;); /** * @type {Array&lt;string&gt;} */ var polylines = string.split(&quot;),(&quot;); /** * @type {Array&lt;Array&lt;google.maps.LatLng&gt;&gt;} */ var resultList = new Array(polylines.length); polylines[0].replace(&quot;(&quot;, &quot;&quot;); polylines[polylines.length-1].replace(&quot;)&quot;, &quot;&quot;); for (var i = 0; i &lt; polylines.length; i++) { resultList[i] = parseLineCoords(polylines[i]); } return new google.maps.Data.MultiLineString(resultList); } /** * @param {string} string * * @return {google.maps.Data.LineString} */ function parseLineString (string) { string = string.replace(&quot;LINESTRING(&quot;,&quot;&quot;); string = string.replace(&quot;)&quot;,&quot;&quot;); return new google.maps.Data.LineString(parseLineCoords(string)); } × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"generateMap.js.html":{"id":"generateMap.js.html","title":"Source: generateMap.js","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Source: generateMap.js /** * @module Map-Objects_Generator * */ var styledMapType; var map; var marker; var markershape; var markershapeFiltered; var center; var infoWindows = []; var markers = []; var old_feature; var old_infowindow; var location_markers = {}; var user_input_marker; var marker_to_change; var change_input = ['Ändern','Modifier','Modificare','Spremeni:']; var delete_input = ['Löschen','Effacer','Cancellare','Izbriši']; var question_marker = ['Wie Sagt man bei Ihnen?', 'Comment est-ce qu´on dit chez vous?' , 'Come si dice da voi?', 'Kako se pri vas reče?']; var crowder = ['anonymer User','Utilisateur anonyme','Utente anonimo','Anonimen uporabnik']; jQuery(document).ready(function($) { initMap(); jQuery.ajax({ dataType: &quot;json&quot;, url: url.plugins_Url+&quot;js/json/mapstyle_dark_minimal.json&quot;, success: function(data){ styledMapType = data; map.setOptions({styles: styledMapType}); } }); }); /** * Initialize the Google Map - Options, Styles and Markers * */ function initMap(){ var myOptions = { center: {lat: 45.483678, lng: 11.410439}, zoom:6, disableDefaultUI: true, styles: styledMapType }; var styledMapType = new google.maps.StyledMapType ([ { &quot;featureType&quot;: &quot;road&quot;, &quot;stylers&quot;: [ { &quot;visibility&quot;: &quot;off&quot; } ] } ]); map = new google.maps.Map(document.getElementById('map'), myOptions); map.setOptions({styles : styledMapType}); markershapeFiltered = { path: &quot;m 96,63.999986 q 0,-13.24998 -9.37497,-22.62502 -9.375032,-9.37496 -22.625027,-9.37496 -13.250004,0 -22.625007,9.37496 -9.37499,9.37504 -9.37499,22.62502 0,13.25 9.37499,22.625 9.375003,9.375 22.625007,9.375 13.249995,0 22.625027,-9.375 Q 96,77.249986 96,63.999986 z m 32,0 q 0,13.625 -4.125,22.375 L 78.375005,183.12501 q -1.999996,4.125 -5.937511,6.49998 Q 68.500043,192 64.000003,192 q -4.499987,0 -8.437497,-2.37501 -3.937505,-2.37498 -5.812493,-6.49998 L 4.1249985,86.374986 Q 0,77.624986 0,63.999986 0,37.499946 18.750001,18.750006 37.500011,6e-6 64.000003,6e-6 90.500008,6e-6 109.25,18.749996 128,37.499946 128,63.999986 z&quot;, fillColor: '#939393', fillOpacity: 0.8, scale: 0.22, strokeColor: '#7e7e7e', strokeWeight: 1, anchor: new google.maps.Point(64, 192) }; markershape = { path: &quot;m 96,63.999986 q 0,-13.24998 -9.37497,-22.62502 -9.375032,-9.37496 -22.625027,-9.37496 -13.250004,0 -22.625007,9.37496 -9.37499,9.37504 -9.37499,22.62502 0,13.25 9.37499,22.625 9.375003,9.375 22.625007,9.375 13.249995,0 22.625027,-9.375 Q 96,77.249986 96,63.999986 z m 32,0 q 0,13.625 -4.125,22.375 L 78.375005,183.12501 q -1.999996,4.125 -5.937511,6.49998 Q 68.500043,192 64.000003,192 q -4.499987,0 -8.437497,-2.37501 -3.937505,-2.37498 -5.812493,-6.49998 L 4.1249985,86.374986 Q 0,77.624986 0,63.999986 0,37.499946 18.750001,18.750006 37.500011,6e-6 64.000003,6e-6 90.500008,6e-6 109.25,18.749996 128,37.499946 128,63.999986 z&quot;, fillColor: 'blue', fillOpacity: 0.8, scale: 0.22, strokeColor: '#000080', strokeWeight: 1, anchor: new google.maps.Point(64, 192) }; markershapeChoosen = { path: &quot;m 96,63.999986 q 0,-13.24998 -9.37497,-22.62502 -9.375032,-9.37496 -22.625027,-9.37496 -13.250004,0 -22.625007,9.37496 -9.37499,9.37504 -9.37499,22.62502 0,13.25 9.37499,22.625 9.375003,9.375 22.625007,9.375 13.249995,0 22.625027,-9.375 Q 96,77.249986 96,63.999986 z m 32,0 q 0,13.625 -4.125,22.375 L 78.375005,183.12501 q -1.999996,4.125 -5.937511,6.49998 Q 68.500043,192 64.000003,192 q -4.499987,0 -8.437497,-2.37501 -3.937505,-2.37498 -5.812493,-6.49998 L 4.1249985,86.374986 Q 0,77.624986 0,63.999986 0,37.499946 18.750001,18.750006 37.500011,6e-6 64.000003,6e-6 90.500008,6e-6 109.25,18.749996 128,37.499946 128,63.999986 z&quot;, fillColor: 'green', fillOpacity: 0.9, scale: 0.22, strokeColor: '#004600', strokeWeight: 1, anchor: new google.maps.Point(64, 192) }; /* marker = new google.maps.Marker({ map: map, draggable: false, animation: google.maps.Animation.DROP, position: {lat: 48.1520, lng: 11.5535}, icon: markershape }); */ } /** * Adds Alpine convention Polygon * @param {String} geoData Geodata - Polygon */ function addGeometryAlps(geoData){ var polygon = parseGeoData(geoData); var /** Object */ options = {&quot;geometry&quot; : polygon}; var feature = new google.maps.Data.Feature(options); map.data.add(feature); feature.setProperty('selected', false); map.data.setStyle(function(feature) { var color = 'blue'; var opacity = 0; /*if (feature.getProperty('selected')) { color = 'green'; opacity = 0.4; }*/ return /** @type {google.maps.Data.StyleOptions} */({ fillOpacity:opacity, fillColor: color, strokeColor: color, strokeWeight: 2 }); }); } /** * Adds location polygon * @param {String} geoData Geo data * @param {Object} data Object containing data for the polygon */ function addGeometry(geoData,data){ var location_name = data.name; location_name = location_name.replace(/\\\\/g, &quot;&quot;); var center = parseGeoData(data.centerCoordinates); var lat_g = parseGeoData(data.centerCoordinates).get().lat(); var lng_g = parseGeoData(data.centerCoordinates).get().lng(); if(old_feature != null){ map.data.remove(old_feature); //console.log('removeThat Thing'); //map.data.remove(old_infowindow); } if(old_infowindow != null){ old_infowindow.close(); old_infowindow = null; } var polygon = parseGeoData(geoData); var /** Object */ options = {&quot;geometry&quot; : polygon}; var featureSelected = new google.maps.Data.Feature(options); // featureSelected.setProperty('selected', true); featureSelected.setProperty('selected', check_user_aesserungen_in_location(location_name)); featureSelected.setProperty('location', location_name); var infoWindowContent = [ &quot;&lt;div id='inputWrapper'&gt;&quot;, location_name , &quot;&lt;/div&gt;&quot; ].join(&quot;&quot;); var infowindow = new google.maps.InfoWindow(); var infowindow = new google.maps.InfoWindow({ content:infoWindowContent, position: {lat: lat_g, lng:lng_g } }); infoWindows.push(infowindow); old_feature = featureSelected; old_infowindow = infowindow; map.data.add(featureSelected); map.data.setStyle(function(featureSelected) { var color = 'blue'; var fillColor = '#2068b5'; var opacity = 0; if (featureSelected.getProperty('selected')) { color = '#009900'; fillColor = '#009900'; opacity = 0.1; //fillOpacity = 0.1; } return /** @type {google.maps.Data.StyleOptions} */({ fillOpacity:opacity, fillColor: fillColor, strokeColor: color, strokeWeight: 2 }); }); change_feature_style(featureSelected,check_user_aesserungen_in_location(location_name)); infowindow.open(map); /* map.data.addListener('click', function(event) { var feature = event.feature; feature.setProperty('choosen', true); }); if(featureSelected.getProperty('choosen')){ infowindow.open(map); }*/ } /** * Displays Marker For one location * @param {Object} element Contains location information(name, id), number of answers in that location and if the current author has answers in it. * @param {Boolean} can_edit Checks if the user can edit the input. * */ function display_location_markers(element,can_edit){ var location_coordinates = parseGeoData(element.geo_data.geo); var count_aeusserung_per_location = element.count.toString(); var location_id = element.geo_data.location_id.toString(); var userMarker = element.geo_data.userCheck; var is_admin = can_edit; if(is_admin)userMarker=true; var marker_color; if(userMarker == 0){ marker_color = &quot;blue&quot;; }else{ marker_color = &quot;green&quot;; } //{lat:location_coordinates.get().lat(),lng:location_coordinates.get().lng()} var marker = addCircleMarker(location_coordinates.get(),count_aeusserung_per_location,marker_color); marker.location_id = location_id; /*Property Location_ID fuer Marker*/ marker.aeusserungen_count = count_aeusserung_per_location; if(userMarker == 0){ marker.user_marker = false; } else{ marker.user_marker = true; } location_markers[element.geo_data.location_id] = marker; } /** * Adds a marker when user enters an answer for a new location. * @param {Object} obj Data * @param {Int} aeusserung_id Submited Answer Id */ function add_user_marker(obj,aeusserung_id){ var coordinates = parseGeoData(obj.centerCoordinates); var infoWindowOrtsname = obj.name; var concept = obj.concept; var concept_id = obj.concept_id; var bezeichnung = obj.bezeichnung; var aeusserung_id = aeusserung_id; var location_id = obj.location_id; // var green_marker = { // url: url.plugins_Url+&quot;assets/images/green_marker.png&quot;, // size: new google.maps.Size(30,45), // // origin: new google.maps.Point(0, 0), // // anchor: new google.maps.Point(0, 32) // }; markerSelected = new google.maps.Marker({ map: map, draggable: false, animation: google.maps.Animation.DROP, position:{lat:coordinates.get().lat(), lng:coordinates.get().lng()}/*{lat:coordinates.get().lat(), lng:coordinates.get().lng()}*/, icon: url.plugins_Url+&quot;assets/images/green_marker.png&quot;, zIndex: 20001 }); user_input_marker = markerSelected; /*global user_input_marker*/ /* var infoWindowContent = [ &quot;&lt;div class='inputWrapper'&gt;&quot;, &quot;&quot; + translateInfoWindowText(infoWindowOrtsname, concept,bezeichnung, current_user) + &quot;&quot;, &quot;&lt;div class='infbtnwrapper'&gt;&lt;button style='display:inline-block;' id='edit_input' type='button' class='btn btn-primary btn-sm'&gt;&quot; + change_input[current_language] + &quot;&lt;/button&gt;&quot;, &quot;&lt;button style='display:inline-block;margin-left: 5px;padding: 4px; font-size: 14px;' class='btn btn-primary ' data-concept_id=\\&quot;&quot; + concept_id + &quot;\\&quot; data-todelete=\\&quot;&quot; + aeusserung_id + &quot;\\&quot; data-ort= \\&quot;&quot; + infoWindowOrtsname + &quot;\\&quot; type='button' id='deleteAuesserung' type='button'&gt;&quot; + delete_input[current_language] + &quot;&lt;/button&gt;&lt;/div&gt;&quot;, &quot;&lt;/div&gt;&quot; ].join(&quot;&quot;); var contentNode = jQuery(infoWindowContent)[0]; var infowindow = new google.maps.InfoWindow({ content: contentNode }); infowindow.addListener('domready', function() { jQuery(this.getContent()).find('#deleteAuesserung').off('click').on('click',function(){ infowindow.close(); markerSelected.setMap(null); for(var i = 0; i &lt; markers.length; i++){ if(markers[i].marker===markerSelected)markers.splice(i,1); } deleteInput(aeusserung_id,infoWindowOrtsname,concept_id,location_id); }); jQuery(this.getContent()).find('#edit_input').off('click').on('click',function(){ editInputA(infoWindowOrtsname,concept,bezeichnung,aeusserung_id,concept_id,infowindow,true,location_id); marker_to_change = markerSelected; }); }); */ /*close all other infowindows*/ closeAllInfoWindows(); setTimeout(function(){user_input_marker.setMap(null)}, 1100); /* infoWindows.push(infowindow); setTimeout(function(){infowindow.open(map, markerSelected)}, 1000);*/ } function closeAllInfoWindows(){ for(var i = 0; i &lt; infoWindows.length; i++){ infoWindows[i].close(); } } function smoothZoom (map, max, cnt) { //var mapObject = new google.maps.Map(document.getElementById(&quot;map&quot;), myOptions); if (cnt &gt;= max) { return; } else { z = google.maps.event.addListener(map, 'zoom_changed', function(event){ google.maps.event.removeListener(z); smoothZoom(map, max, cnt + 1); }); setTimeout(function(){map.setZoom(cnt)}, 80); // 80ms is what I found to work well on my system -- it might not work well on all systems } } jQuery(&quot;.userAuesserung&quot;).focus(function(){ jQuery(this).attr('id', 'currentInput'); }); function setQ(con, id){ closeAllInfoWindows(); // console.log('Closed infoowindows'); // console.log(con + id); jQuery('#word_span').text(con); jQuery('#word_span').attr(&quot;data-id_concept&quot;,id); //filterMarkers(id); var index = concepts_index_by_id[parseInt(id)].index; if(current_concept_index!=-1)deSelectTableEntry(current_concept_index); selectTableEntry(index); current_concept_index = index; concept_selected = true; checkImageModal(id,con); /*position problems for popover*/ // setDynamicContent(); // setTimeout(function(){displayTooltips(true)}, 1000); } function translateInfoWindowText(ort,concept,bezeichnung,author){ var text = ''; if(current_user.localeCompare(author) != 0){ var string = author; var substring = &quot;anonymousCrowder_&quot;; if(string.indexOf(substring) == 0){ author = crowder[current_language]; } switch(current_language){ case 0: text = &quot;In &quot; + ort + &quot; sagt &quot; + author + &quot; zu&lt;br&gt; &lt;span id='i_span_2'&gt;&quot; + concept + &quot;: &lt;/span&gt;&quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; case 1: text = &quot;À &quot; + ort + &quot;, pour &lt;span id='i_span_2'&gt;&quot; + concept + &quot;&lt;/span&gt; &quot; + author + &quot; dit:&lt;br&gt; &quot; + &quot; &quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; case 2: text = &quot;A &quot; + ort + &quot;, per &lt;span id='i_span_2'&gt;&quot; + concept + &quot;&lt;/span&gt; &quot; + author + &quot; dice:&lt;br&gt; &quot; + &quot; &quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; case 3: text = &quot;V &quot; + ort + &quot; &quot; + author + &quot; reče za&lt;br&gt; &lt;span id='i_span_2'&gt;&quot; + concept + &quot;: &lt;/span&gt;&quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; } }else{ switch(current_language){ case 0: text = &quot;Ihre Antwort:&lt;br&gt;&quot; + &quot;In &quot; + ort + &quot; sagt man zu &lt;br&gt;&lt;span id='i_span_2'&gt;&quot; + concept + &quot;: &lt;/span&gt;&quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; case 1: text = &quot;Votre réponse:&lt;br&gt;&quot; + &quot;À &quot; + ort + &quot;, pour &lt;br&gt;&lt;span id='i_span_2'&gt;&quot; + concept + &quot;: &lt;/span&gt; on dit &quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; case 2: text = &quot;La vostra risposta: &lt;br&gt;&quot; + &quot;A &quot; + ort + &quot;, per &lt;br&gt;&lt;span id='i_span_2'&gt;&quot; + concept + &quot;: &lt;/span&gt; si dice &quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; case 3: text = &quot;Vaš odgovor:&lt;br&gt;&quot; + &quot;V &quot; + ort + &quot; se reče za &lt;br&gt;&lt;span id='i_span_2'&gt;&quot; + concept + &quot;: &lt;/span&gt; &quot; + &quot;&lt;span id='i_span_1'&gt;\\&quot;&quot; + bezeichnung + &quot;\\&quot;&lt;/span&gt;&quot;; break; } } return text; } function addCircleMarker(position,label,color){ var image = create_marker_image(label,color); // the clickable region of the icon. // var shape = { // coords: [1, 1, 1, 104, 80, 104, 80 , 1], // type: 'poly' // }; var z_index = 20000-parseInt(label); var marker = new google.maps.Marker({ position: position, map: map, icon: image, // shape: shape, zIndex: z_index }); marker.addListener('click', function() { closeAllInfoWindows(); openLocationListModal(marker); }); return marker; } function change_marker(marker,number,color){ var label = (parseInt(marker.aeusserungen_count)+(number)).toString(); var color; marker.aeusserungen_count = label; var num_entries = check_for_entries(marker.location_id); var cur_user_entries = check_for_current_user_entries(marker.location_id); if(num_entries&lt;=0){ marker.setMap(null); delete location_markers[marker.location_id]; }else if(cur_user_entries &lt;= 0){ color = &quot;blue&quot;; location_markers[marker.location_id].user_marker = false; }else if(cur_user_entries &gt; 0){ color = &quot;green&quot;; location_markers[marker.location_id].user_marker = true; } var image = create_marker_image(label,color); marker.setIcon(image); } function check_for_entries(location_id){ var array_to_check = aeusserungen_by_locationindex[location_id]; var entered_aeusserungen = 0; /* for(var i = 0; i&lt; array_to_check.length; i++){ entered_aeusserungen++; }*/ for (var key in array_to_check) { if (array_to_check.hasOwnProperty(key)) { entered_aeusserungen++; } } return entered_aeusserungen; } function check_for_current_user_entries(location_id){ var array_to_check = aeusserungen_by_locationindex[location_id]; var user_entered_aeusserungen = 0; for (var key in array_to_check) { if (array_to_check.hasOwnProperty(key)) { if(current_user.localeCompare(array_to_check[key].author) == 0){ user_entered_aeusserungen++; } } } return user_entered_aeusserungen; } function create_marker_image(label,color){ var size; if(label.length==1)size=26; else if(label.length==2)size=34; else size=42; // conflict resolved var number = parseInt(label); var add = Math.floor(number/4); size += add; if(size&gt;50)size=50; //max size = 50px; size*=2; //multiply size for double size image for better quality var canvas = document.createElement('canvas'); var context = canvas.getContext(&quot;2d&quot;); canvas.width = size; canvas.height = size; var centerX = canvas.width / 2; var centerY = canvas.height / 2; var radius = (size/2)-4; //-4 for stroke width var fillcolor = &quot;rgba(0,0,139,0.88)&quot;; var strokecolor = &quot;#3366ff&quot; if(color==&quot;green&quot;){ fillcolor=&quot;rgba(0,100,0,0.88)&quot;; strokecolor = &quot;#00af00&quot; } context.beginPath(); context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false); context.fillStyle = fillcolor; context.fill(); context.lineWidth = 4; context.strokeStyle = strokecolor; context.stroke(); context.font = &quot;25px Arial&quot;; var y = (size/2)+8; if(color==&quot;blue&quot;){ context.fillStyle = '#7396ff'; } else{ context.fillStyle = '#2BBF17'; } context.textAlign=&quot;center&quot;; context.fillText(label, centerX, y); var image = { url: canvas.toDataURL(), scaledSize: new google.maps.Size(size/2, size/2), origin: new google.maps.Point(0,0), anchor: new google.maps.Point(size/4, size/4) }; return image; } function change_feature_style(current_feature,has_aesserungen){ if(has_aesserungen/*current_feature.getProperty('selected')*/){ map.data.overrideStyle(current_feature, {color : '#009900',fillColor : '#009900',strokeColor: '#009900',fillOpacity:0.2}); }else{ map.data.overrideStyle(current_feature, {color : 'blue',fillColor : '#2068b5',fillOpacity:0.2,strokeColor: 'blue'}); } //console.log(&quot;Feature property is&quot; + current_feature.getProperty('selected')); } × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Modules × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator SummaryThis is a documented Version of the Client-sided Crowndsourcing Tool for VerbaAlpina. All JavaScript files are represented in this documentation as modules, describing different functionalities. Module DescriptionModule Ajax Calls defines and performes ajax calls to the database. It's main function is to initiate the communication to the server and load the Alpine convention polygon and data from the database. Module Content Interactions contains the UI and Logic components of the Crowdsourcing tool. Generate Map manages all geo objects: polygons, markers. Tool TranslationThe Tool uses arrays to enable the translations. Global VariablesFor better reading of the documentation, global variables that are used for translating the tool are not comantated. × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"module-Ajax_Calls.html":{"id":"module-Ajax_Calls.html","title":"Module: Ajax_Calls","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Module: Ajax_Calls Difines and performes Ajax Calls to the server for - loading data from the database, building global javascript arrays with that data and saving user's input. Source: actions_ajax.js, line 1 Members &lt;inner&gt; aeusserungen :Array Array of all submitted answers by the user. Type: Array Source: actions_ajax.js, line 60 &lt;inner&gt; anonymousCrowder :Boolean Variable to check if the user is anonymous. Type: Boolean Source: actions_ajax.js, line 97 &lt;inner&gt; concepts :Array Array of all concepts in the user's language. Type: Array Source: actions_ajax.js, line 20 &lt;inner&gt; crowder_lang :String Language Number choosen by logged in users. Type: String Source: actions_ajax.js, line 109 &lt;inner&gt; current_user :String Name of the user. May be name of the logged in user or the anonymous_{unique number}. Type: String Source: actions_ajax.js, line 103 &lt;inner&gt; existingLocations :Array Array containing all location ids, where the user has entered an answer. Type: Array Source: actions_ajax.js, line 48 &lt;inner&gt; id_auesserung_current_input not used Deprecated: Yes Source: actions_ajax.js, line 66 &lt;inner&gt; images :Array Array of all links to the images. Type: Array Source: actions_ajax.js, line 27 &lt;inner&gt; important_concepts_count :Integer Number of importain concepts - used to mark the concepts in the concepts data table. Type: Integer Source: actions_ajax.js, line 72 &lt;inner&gt; indexed_locations_aeusserungen_array :Array not used Type: Array Deprecated: Yes Source: actions_ajax.js, line 79 &lt;inner&gt; language_is_set :Boolean Checks if user has already choosen a language from the modal menue. Defaults to false if user is not logged in. Type: Boolean Source: actions_ajax.js, line 85 &lt;inner&gt; locations :Array Array of all municipalities Type: Array Source: actions_ajax.js, line 13 &lt;inner&gt; submit_button_clicked :Boolean Improves UI, used for state check, when the user submits an answer. Type: Boolean Source: actions_ajax.js, line 54 &lt;inner&gt; submitedAnswers :Array Array of all answers submitted by the user. Type: Array Source: actions_ajax.js, line 34 &lt;inner&gt; submitedAnswers_indexed :Array Indexed Array of all answers submitted by the user. Type: Array Source: actions_ajax.js, line 41 &lt;inner&gt; user_email Email Adress of the logged in user. Source: actions_ajax.js, line 114 &lt;inner&gt; userLoggedIn :Boolean Variable to check if the user has logged in. Type: Boolean Source: actions_ajax.js, line 91 Methods &lt;inner&gt; build_indexed_aeusserungen_array(aeusserungen) Build an indexed array(index location id), containing all answers(type: aeusserung, id_aeusserung, author, ortsname(location), word) submitted by the users. Parameters: Name Type Description aeusserungen Array Array with all answers by users. Source: actions_ajax.js, line 525 Returns: Indexed array(location id: [answers]) Type Array &lt;inner&gt; check_user_aesserungen_in_location(location) Checks if the user has any answers in the current location. This is used for changing the color of the location marker: blue - user has not entered a answer in the location, green - user has entered an answer in that location. Parameters: Name Type Description location String [description] Source: actions_ajax.js, line 1077 &lt;inner&gt; check_user_aeusserungen() Check if user(only for not logged in users) has submited answers and delete crowder_id cookie if he has no answers. Source: actions_ajax.js, line 1065 &lt;inner&gt; checkEnteredConcepts_indexed() [checkEnteredConcepts_indexed description] Source: actions_ajax.js, line 836 &lt;inner&gt; checkTableEntry(_concept_id) [checkTableEntry description] Parameters: Name Type Description _concept_id Int [description] Source: actions_ajax.js, line 755 &lt;inner&gt; contains(needle) check if string contains a substring Parameters: Name Type Description needle String [description] Source: actions_ajax.js, line 929 &lt;inner&gt; create_submited_answers_index_array(arrayA, can_edit) Creates a indexed array. Parameters: Name Type Description arrayA Array Input Array can_edit Boolean Checks if the user can edit this entry. Source: actions_ajax.js, line 473 Returns: indexed Array Type Array &lt;inner&gt; createCookie(name, value, days) Creates a cookie with name, value and exp. date Parameters: Name Type Description name String [description] value String [description] days Int [description] Source: actions_ajax.js, line 963 &lt;inner&gt; declare_user_data(obj) Saves user data in global variables. Parameters: Name Type Description obj Object [description] Source: actions_ajax.js, line 1043 &lt;inner&gt; deleteFromAnswers_indexed(id_auesserung, id_location) Delete user's answer from submitedAnswers_indexed and aeusserungen_by_locationindex. Parameters: Name Type Description id_auesserung Int Submited answer Id id_location Int Location Id Source: actions_ajax.js, line 682 &lt;inner&gt; deleteFromConceptTable(_concept_id) [deleteFromConceptTable description] Parameters: Name Type Description _concept_id Int [description] Source: actions_ajax.js, line 730 &lt;inner&gt; deleteInput(id_auesserung, ort, concept_id, location_id) Sends an Ajax call to delete answer from the server. Parameters: Name Type Description id_auesserung Integer Submited answer Id ort String Location name concept_id Integer Concept Id location_id Integer Location Id Source: actions_ajax.js, line 634 &lt;inner&gt; deSelectTableEntry(table_index) [deSelectTableEntry description] Parameters: Name Type Description table_index Int [description] Source: actions_ajax.js, line 808 &lt;inner&gt; eraseCookie(name) Delete cookie. Parameters: Name Type Description name String [description] Source: actions_ajax.js, line 994 &lt;inner&gt; fill_answers(obj) Adds an object, containing - Concept(and id), submited answer(and id), location and author of the submitted answer, to submitedAnswers(global array). Parameters: Name Type Description obj Object Contains a single concept-submitted entry, that the user has previously created. Source: actions_ajax.js, line 451 &lt;inner&gt; fill_submitted_answers(array_submitted_answers) Loops through all submitted answers and performs fill_answers() on each of them. Parameters: Name Type Description array_submitted_answers Array An array containg submited answers by the user. Source: actions_ajax.js, line 439 &lt;inner&gt; get_aeussetungen_locations_curLang(arrayA, can_edit) Display markers for each location and the corresponding number of answers in each one. Parameters: Name Type Description arrayA Array Indexed array(index: location id) of each location(name, center point). can_edit Boolean Checks if the user can edit the answers(Only for admins). Source: actions_ajax.js, line 507 &lt;async, inner&gt; gets alpine convention borders() Get and display AlpenKonventione Polygon Source: actions_ajax.js, line 180 Returns: border coordinates Type Array &lt;async, inner&gt; gets image links() Get all images links from server. Source: actions_ajax.js, line 164 Returns: images Type Array &lt;async, inner&gt; gets information about the importaint concepts() Get number of importain concepts. Source: actions_ajax.js, line 149 Returns: important_concepts_count Type Array &lt;async, inner&gt; gets information about the user from the server() Initiating the async calls to server. Source: actions_ajax.js, line 133 Returns: user_data Type Array &lt;async, inner&gt; getUserID() Gets user's ID. Used to generate a unique crowder_id cookie, when the user submits an answer. Source: actions_ajax.js, line 239 &lt;inner&gt; isDuplicate_indexed(answer) Checks if the user's answer is a dublicate(he has already entered the same answer for the same concept in that location). Parameters: Name Type Description answer Array [description] Source: actions_ajax.js, line 901 Returns: [description] Type Boolean &lt;inner&gt; isEmpty(obj) Check if an object is empty. Parameters: Name Type Description obj Object [description] Source: actions_ajax.js, line 1003 Returns: [description] Type Boolean &lt;async, inner&gt; load_location_polygon() Load the location's polygon to be displayed on the map, when user's answer is successfully saved to the database. Source: actions_ajax.js, line 286 &lt;inner&gt; markInputRed(input) Marks the input field red if user tries to submit the same answer or an empty field, when changing his answer. Parameters: Name Type Description input String [description] Source: actions_ajax.js, line 850 &lt;inner&gt; readCookie(name) Read value of a cookie by name. Parameters: Name Type Description name String [description] Source: actions_ajax.js, line 978 Returns: [description] Type String &lt;inner&gt; returnChangeInput() created html element, which will be used in editInput() Source: actions_ajax.js, line 551 See: editInput() in content_interaction.js Returns: HTML Type String &lt;async, inner&gt; save_word_async() Send all data(location, location id, concept, concept id, user answer and current user id(not logged in users) or user name(logged in users)) to server. Source: actions_ajax.js, line 255 &lt;inner&gt; saveWord() Gets values from all answer-input fields and performs an ajax call with the user's answer to be saved in the database. Performs all checks if all fields are filled correctly. And places a marker when the input is saved in the database. Source: actions_ajax.js, line 213 &lt;inner&gt; selectTableEntry(table_index) [selectTableEntry description] Parameters: Name Type Description table_index Int index of the selected entry in the data table Source: actions_ajax.js, line 786 &lt;async, inner&gt; starts the initial ajax calls when the site has loaded.() Initializes Ajax calls when document is loaded. Source: actions_ajax.js, line 122 &lt;inner&gt; updateAnswers_indexed(id_auesserung, input, id_location) Update user's answer in submitedAnswers_indexed and aeusserungen_by_locationindex. Parameters: Name Type Description id_auesserung Int Submited answer Id input String User's Input id_location Int Location Id Source: actions_ajax.js, line 698 &lt;inner&gt; updateInput(concept, id_auesserung, concept_id, id_location, row_to_update) Updated user's answer(Used by editInputA()). Parameters: Name Type Description concept String Concept name id_auesserung Integer Id of the submited answer concept_id Integer Concept Id id_location Integer Location Id row_to_update Integer The row number from the data table that will be updated Source: actions_ajax.js, line 581 See: editInputA() in generateMap.js &lt;inner&gt; userRegisterDone(user_name) Saves the choosen language of the user in the database. Parameters: Name Type Description user_name String [description] Source: actions_ajax.js, line 1017 × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:41+02:00 using the DocStrap template. "},"module-Content_Interactions.html":{"id":"module-Content_Interactions.html","title":"Module: Content_Interactions","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Module: Content_Interactions Source: content_interactions.js, line 1 Members &lt;inner&gt; concepts_cur_lang :Array Array of all concepts and their ids in the current language choosen. Type: Array Source: content_interactions.js, line 217 &lt;inner&gt; concepts_index_by_id An indexed array containing concept name and the concept id as the array index. Source: content_interactions.js, line 222 &lt;inner&gt; current_language :Number Saves the language choosen by the user from the modal. 0 - German, 1 - French, 2 - Italian, 3 - Slovenian Type: Number Source: content_interactions.js, line 209 &lt;inner&gt; location_data :Array Array with all data for the locations data table. Type: Array Source: content_interactions.js, line 233 &lt;inner&gt; num_of_answers_by_id Index array of user entered answers. Index - Concept Id, Number of user Input of the assosiated concept. Source: content_interactions.js, line 227 Methods &lt;inner&gt; addModalListeners() Adds event listeners to all modals. Source: content_interactions.js, line 1157 &lt;inner&gt; bindShowListeners_Modal() [bindShowListeners_Modal description] Source: content_interactions.js, line 1237 &lt;inner&gt; buildCarousel(_images, _caption) Build Image Slider Parameters: Name Type Description _images Array [description] _caption Array [description] Source: content_interactions.js, line 1764 Returns: Div-element, containg images and their captions. Type String &lt;inner&gt; calculateCenter() [calculateCenter description] Source: content_interactions.js, line 1818 &lt;inner&gt; checkLoginPopUp() Deprecated: Yes Source: content_interactions.js, line 2684 &lt;inner&gt; createAnswersToEntryNumbers(submitedAnswersIndexed) Builds an indexed array containing the number of entries for concepts that the user has entered and the concept's id. Parameters: Name Type Description submitedAnswersIndexed Object indexed array containing all submited entries by the current user. Source: content_interactions.js, line 1062 Returns: contains concept id and number of entries for the associated concept. Type Object &lt;inner&gt; createConceptIndexList(concepts_cur_lang) Creates and returns a indexed array of all concepts in the user's language. Parameters: Name Type Description concepts_cur_lang Array Array with all concepts in the language of the user. Source: content_interactions.js, line 1044 Returns: Indexed Array containing concept id and the concept in the current language. Type Object &lt;inner&gt; cycleText(element, textlist, i, callback) Change the language displayed. Used for Welcome Modal. Parameters: Name Type Description element String [description] textlist Array [description] i Int [description] callback function [description] Source: content_interactions.js, line 1841 &lt;inner&gt; editInput() Deprecated: Yes Source: content_interactions.js, line 2185 &lt;inner&gt; editInputA(id_auesserung, id_concept, location_id, concept, row_to_update) When user changes his entry the data is then been processed and updated to the server. Parameters: Name Type Description id_auesserung Int [description] id_concept Int [description] location_id Int [description] concept String [description] row_to_update Int [description] Source: content_interactions.js, line 2156 Returns: [description] Type String &lt;inner&gt; filterMarkers() Deprecated: Yes Source: content_interactions.js, line 2252 &lt;inner&gt; getLocationListTableData(in_data) Build locations data for the data table. Parameters: Name Type Description in_data Array [description] Source: content_interactions.js, line 2372 Returns: [description] Type Array &lt;async, inner&gt; getTableData() Get locations in current language Source: content_interactions.js, line 613 &lt;async, inner&gt; getTableData() Get Aeusserungen and the Manicipilities associated Source: content_interactions.js, line 632 &lt;inner&gt; getTableData(in_data, origin) Builds Arrays containg the data for each row that will be displayed in the data tables. Parameters: Name Type Description in_data Array Can be Concepts or Locations Arrays. origin String concept or location Source: content_interactions.js, line 1128 Returns: Contains the html elements with the data for the data tables. Type Array &lt;inner&gt; handleLocationSpanClick() [handleLocationSpanClick description] Source: content_interactions.js, line 1010 &lt;inner&gt; handleWordSpanClick() [handleWordSpanClick description] Source: content_interactions.js, line 986 &lt;inner&gt; hideAllOpenModals() [hideAllOpenModals description] Source: content_interactions.js, line 2695 &lt;inner&gt; initConceptModal() [initConceptModal description] Source: content_interactions.js, line 1891 &lt;inner&gt; initLocationsModal() [initLocationsModal description] Source: content_interactions.js, line 1901 &lt;inner&gt; initTool() Initializes UI elements according to the browser. Sets the map in the center of the browser. Source: content_interactions.js, line 289 &lt;inner&gt; initWelcomeModal() Initializes the Modals at the start of the CS-Tool, when the user has not yet choosen a language, has not yet registred. Source: content_interactions.js, line 810 &lt;inner&gt; menu_is_up() [menu_is_up description] Source: content_interactions.js, line 1032 &lt;inner&gt; moveElements() Adjusts Visial Elements, solves problem with wordpress visialization. Source: content_interactions.js, line 1872 &lt;inner&gt; openLanguageModal() Opens Language Modal for the user to choose prefered language. Source: content_interactions.js, line 1112 &lt;inner&gt; openLocationListModal(marker) Open location's data table. Parameters: Name Type Description marker Object Location's marker. Source: content_interactions.js, line 2338 &lt;inner&gt; refresh_page() Deprecated: Yes Source: content_interactions.js, line 2622 &lt;inner&gt; reMeasureDatatables() [reMeasureDatatables description] Source: content_interactions.js, line 2632 &lt;inner&gt; replaceSpecialChars(_in) Replace special characters(from different languages) to siplify the search. Used to simplify searching for concept or location that have spacial characters in different languages. Parameters: Name Type Description _in String [description] Source: content_interactions.js, line 2281 Returns: [description] Type String &lt;inner&gt; setDynamicContent() Ajusts HTML-Elemets size according to the browser. Source: content_interactions.js, line 373 &lt;inner&gt; setRandomTitelImage(callback, modal_id) Sets a random image as background for the different modals. Parameters: Name Type Description callback function [description] modal_id Int [description] Source: content_interactions.js, line 2313 &lt;inner&gt; showCustomBackdrop() [showCustomBackdrop description] Source: content_interactions.js, line 1915 &lt;inner&gt; showCustomModalBackdrop() [showCustomModalBackdrop description] Source: content_interactions.js, line 1927 &lt;inner&gt; showPolygon(g_location, g_location_id, index) After Choosing a locations from the location data tables. Get the location's polygon and display it. Parameters: Name Type Description g_location String [description] g_location_id Int [description] index Int [description] Source: content_interactions.js, line 2205 &lt;inner&gt; startLoginTimer() Sets a timer, after which a login/register pop up will show up. Source: content_interactions.js, line 2655 &lt;inner&gt; startMainTool() Initializes the CS-Tool. Performes Ajax Calls to fetch data(locations, user entries) from the server. The gathered data is then stored in global variables. Source: content_interactions.js, line 570 &lt;inner&gt; startTutorial() Initializes the Popover Tutorials. Source: content_interactions.js, line 1093 × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:42+02:00 using the DocStrap template. "},"module-Geo_Parser.html":{"id":"module-Geo_Parser.html","title":"Module: Geo_Parser","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Module: Geo_Parser Source: geo.js, line 1 Methods &lt;inner&gt; parseGeoData(string) Parameters: Name Type Description string string Source: geo.js, line 26 Returns: Type google.maps.Data.Geometry &lt;inner&gt; parseLineCoords(string) Parameters: Name Type Description string string Source: geo.js, line 120 Returns: Type Array.&lt;google.maps.LatLng&gt; &lt;inner&gt; parseLineString(string) Parameters: Name Type Description string string Source: geo.js, line 166 Returns: Type google.maps.Data.LineString &lt;inner&gt; parseMultiLineString(string) Parameters: Name Type Description string string Source: geo.js, line 138 Returns: Type google.maps.Data.MultiLineString &lt;inner&gt; parseMultiPolygon(string) Parameters: Name Type Description string string Source: geo.js, line 65 Returns: Type google.maps.Data.Polygon &lt;inner&gt; parsePoint(string) Parameters: Name Type Description string string Source: geo.js, line 11 Returns: Type google.maps.Data.Point &lt;inner&gt; parsePolygon(string) Parameters: Name Type Description string string Source: geo.js, line 51 Returns: Type google.maps.Data.Polygon &lt;inner&gt; parsePolygonCoords(string) Parameters: Name Type Description string string Source: geo.js, line 93 Returns: Type Array.&lt;Array.&lt;google.maps.LatLng&gt;&gt; × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:42+02:00 using the DocStrap template. "},"module-Map-Objects_Generator.html":{"id":"module-Map-Objects_Generator.html","title":"Module: Map-Objects_Generator","body":" VerbaAlpina Crowdsourcing Tool - Documentation Modules Ajax_CallsContent_InteractionsGeo_ParserMap-Objects_Generator Module: Map-Objects_Generator Source: generateMap.js, line 1 Methods &lt;inner&gt; add_user_marker(obj, aeusserung_id) Adds a marker when user enters an answer for a new location. Parameters: Name Type Description obj Object Data aeusserung_id Int Submited Answer Id Source: generateMap.js, line 287 &lt;inner&gt; addGeometry(geoData, data) Adds location polygon Parameters: Name Type Description geoData String Geo data data Object Object containing data for the polygon Source: generateMap.js, line 154 &lt;inner&gt; addGeometryAlps(geoData) Adds Alpine convention Polygon Parameters: Name Type Description geoData String Geodata - Polygon Source: generateMap.js, line 120 &lt;inner&gt; display_location_markers(element, can_edit) Displays Marker For one location Parameters: Name Type Description element Object Contains location information(name, id), number of answers in that location and if the current author has answers in it. can_edit Boolean Checks if the user can edit the input. Source: generateMap.js, line 243 &lt;inner&gt; initMap() Initialize the Google Map - Options, Styles and Markers Source: generateMap.js, line 50 × Search results Close Documentation generated by JSDoc 3.5.4 on 2017-09-26T17:15:42+02:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
